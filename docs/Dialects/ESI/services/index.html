<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>ESI Global Services - CIRCT</title><meta name=description content="Circuit IR Compilers and Tools"><meta name=generator content="Hugo 0.101.0"><link href=https://circt.llvm.org/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://circt.llvm.org/docs/Dialects/ESI/services/><link rel=stylesheet href=https://circt.llvm.org/css/theme.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://circt.llvm.org/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://circt.llvm.org/js/bundle.js></script>
<script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script><style>:root{}</style></head><body><div class=container><header><h1><div><img src=https://circt.llvm.org//circt-logo.svg width=40px align=absmiddle>
CIRCT</div></h1><p class=description>Circuit IR Compilers and Tools</p></header><div class=global-menu><nav><ul><li class=parent><a href>Community<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=https://llvm.discourse.group/c/Projects-that-want-to-become-official-LLVM-Projects/circt/40>Forums</a></li><li class=child><a href=https://discord.gg/xS7Z362>Chat</a></li></ul></li><li class=parent><a href=https://github.com/llvm/circt/tree/main/>Source<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=/doxygen/>Doxygen</a></li><li class=child><a href=https://github.com/llvm/circt/tree/main/>GitHub</a></li></ul></li></ul></nav></div><div class=content-container><main><h1>ESI Global Services</h1><p><em>This section not fully fleshed out and suffers from poor writing.</em></p><p>ESI will provide access to global resource via <strong>ESI Services</strong>. These
&ldquo;buses&rdquo; define a typed interface and instances are instantiated globally
&ndash; they should be accessible at all levels of the design hierarchy. ESI
services are intended to provide access to truly global resources like
PCIe, shared DMA engines, DRAM, network interfaces, etc. They are
generic enough to be extended to non-physical interfaces like telemetry
&ndash; if you have a centralized telemetry reporting engine, you probably
want any module or submodule in the design to be able to access and
report to it.</p><p>Status: <strong>planning</strong></p><h2 id=serviceclient--directions>Service/Client & Directions&nbsp;<a class=headline-hash href=#serviceclient--directions>¶</a></h2><p>ESI services have servers and clients which are roughly analogous to
masters and slaves in traditional buses, but with slightly different
meanings. Whereas master/slave denote who can initiate a transaction,
servers/clients denote the many-to-many or one-to-many relationship.
Specifically, servers are expected to have many clients. Any service or
client can initiate a transaction, depending on the direction specified.</p><p>Whether a module implements a server or client must be explicitly declared in
the module declaration. Directions (out/in) of data channels/MMIO are
determined by that explicit declaration and the direction specified in the
service definition. Four different directions are allowed in the service
definition: <code>ToServer</code>, <code>ToServers</code>, <code>ToClient</code>, <code>ToClients</code>. The plurals
indicate the messages sent should be broadcast to all servers or client. The
singular form indicates that a specific server or client must be addressed
when sending a message unless the server is single server and the sender is a
client.</p><h2 id=service-definitions>Service Definitions&nbsp;<a class=headline-hash href=#service-definitions>¶</a></h2><p>An ESI service is essentially an interface which modules are required to
implement to connect to a given service. The first attribute which must be
specified is whether multiple servers are allowed via the <code>single</code> or
<code>multi</code> keywords. The second is a list of MMIO and/or channels and
associated directions.</p><h2 id=message-sizes>Message Sizes&nbsp;<a class=headline-hash href=#message-sizes>¶</a></h2><p>A <code>ToServer</code> data channel is free to block (backpressure) other clients
while one is sending a message. As such, in most cases it is best to
keep messages short. While the <strong>list</strong> type is allowed, it is easy to
abuse.</p><h2 id=wire-level-signaling>Wire Level Signaling&nbsp;<a class=headline-hash href=#wire-level-signaling>¶</a></h2><p>The ESI compiler is free to choose any communication substrate which implements
the required functionality. A traditional interconnect is not guaranteed, though
the ESI compiler will may select a traditional signaling protocol like Avalon-MM
or AXI AMBA in many cases.</p><h2 id=examples>Examples&nbsp;<a class=headline-hash href=#examples>¶</a></h2><p>(Pseudocode in C++-ish/Verilog-ish style since MLIR asm syntax TDB.)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// DMA_Request, Response are structs.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>service</span> <span class=n>HostMemory</span> <span class=n>single</span> <span class=p>{</span> <span class=c1>// Specify a service with one server
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ToServer</span> <span class=n>MMIO</span><span class=o>&lt;</span><span class=n>any</span><span class=o>&gt;</span> <span class=n>Memory</span><span class=p>;</span> <span class=c1>// An untyped MMIO wherein the server
</span></span></span><span class=line><span class=cl><span class=c1></span>                                 <span class=c1>// is the &#39;slave&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ToServer</span> <span class=n>DMA_Request</span> <span class=n>DmaReq</span><span class=p>;</span> <span class=c1>// DMA access
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ToClient</span> <span class=n>DMA_Response</span> <span class=n>DmaResp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>module</span> <span class=n>NiosProcessor</span> <span class=p>{</span> <span class=c1>// A NIOS core allowing memory access
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>server</span> <span class=n>HostMemory</span> <span class=n>Mem</span><span class=p>;</span> <span class=c1>// A single master server can be implicitly
</span></span></span><span class=line><span class=cl><span class=c1></span>                           <span class=c1>// instantiated and referred to be the
</span></span></span><span class=line><span class=cl><span class=c1></span>                           <span class=c1>// module&#39;s instance name
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>service</span> <span class=n>Telemetry</span> <span class=n>multi</span> <span class=p>{</span> <span class=c1>// Specify a service with multiple servers
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ToClients</span> <span class=kt>void</span> <span class=n>RequestStatus</span><span class=p>;</span> <span class=c1>// Any server can request a status update
</span></span></span><span class=line><span class=cl><span class=c1></span>                                  <span class=c1>// from every client
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ToServers</span> <span class=n>Event</span><span class=o>&lt;</span><span class=n>AllStatusesUnion</span><span class=o>&gt;</span> <span class=n>Events</span><span class=p>;</span> <span class=c1>// Clients can respond to all
</span></span></span><span class=line><span class=cl><span class=c1></span>                                              <span class=c1>// the servers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Telemetry</span> <span class=n>GlobalBroadcastTelemetry</span><span class=p>;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>service</span> <span class=n>RoutedNetwork</span> <span class=n>multi</span> <span class=p>{</span> <span class=c1>// A service with multiple servers
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ToServer</span> <span class=n>NetworkPacket</span> <span class=n>Send</span><span class=p>;</span> <span class=c1>// Clients must select a server
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ToClient</span> <span class=n>NetworkPacket</span> <span class=n>Recv</span><span class=p>;</span> <span class=c1>// Servers must select a particular client
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ToServer</span> <span class=n>MMIO</span><span class=o>&lt;</span><span class=n>RoutingConfig</span><span class=o>&gt;</span> <span class=n>Config</span><span class=p>;</span> <span class=c1>// A per-server configuration interface
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>RoutedNetwork</span> <span class=n>Net</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>module</span> <span class=n>NetTelemetryProcessor</span> <span class=p>{</span> <span class=c1>// A module which collects telemetry
</span></span></span><span class=line><span class=cl><span class=c1></span>                               <span class=c1>// and sends it over the network
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>server</span> <span class=n>Telemetry</span> <span class=n>TelemetryInput</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>client</span> <span class=n>RoutedNetwork</span> <span class=n>TelemetryOutput</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>NetTelemetryProcessor</span> <span class=n>netTelemProc</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>TelemetryInput</span><span class=p>(</span><span class=n>GlobalBroadcastTelemetry</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>TelemetryOutput</span><span class=p>(</span><span class=n>Net</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><div class=edit-meta><br></div><nav class=pagination><a class="nav nav-prev" href=https://circt.llvm.org/docs/Dialects/ESI/types/ title="ESI data types and communication types"><i class="fas fa-arrow-left" aria-hidden=true></i> Prev - ESI data types and communication types</a>
<a class="nav nav-next" href=https://circt.llvm.org/docs/Dialects/ESI/software_api/ title="ESI Software APIs">Next - ESI Software APIs <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://circt.llvm.org/>Home</a></li><li><a href=https://circt.llvm.org/talks/>Talks and Related Publications</a></li><li><a href=https://circt.llvm.org/getting_started/>Getting Started</a></li><li class="parent has-sub-menu"><a href=https://circt.llvm.org/docs/>Code Documentation<span class="mark opened">-</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://circt.llvm.org/docs/CommandGuide/>CommandGuide<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/CommandGuide/handshake-runner/>handshake-runner</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Charter/>CIRCT Charter</a></li><li class="parent has-sub-menu"><a href=https://circt.llvm.org/docs/Dialects/>Dialects<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Calyx/>'calyx' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/CHIRRTL/>'chirrtl' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Comb/>'comb' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Comb/RationaleComb/>`comb` Dialect Rationale</a></li></ul></li><li class="parent has-sub-menu"><a href=https://circt.llvm.org/docs/Dialects/ESI/>'esi' Dialect<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/ESI/cosim/>ESI cosimulation model</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/types/>ESI data types and communication types</a></li><li class=active><a href=https://circt.llvm.org/docs/Dialects/ESI/services/>ESI Global Services</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/software_api/>ESI Software APIs</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/notes/>Miscellaneous Notes</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/RationaleESI/>The Elastic Silicon Interconnect dialect</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/>'firrtl' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/FIRRTLAnnotations/>FIRRTL Annotations</a></li><li><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/RationaleFIRRTL/>FIRRTL Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/FSM/>'fsm' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/FSM/RationaleFSM/>FSM Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Handshake/>'handshake' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Handshake/RationaleHandshake/>Handshake Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/HW/>'hw' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/HW/RationaleHW/>HW Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/LLHD/>'llhd' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/Moore/>'moore' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/MSFT/>'msft' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Seq/>'seq' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Seq/RationaleSeq/>Seq(uential) Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/StaticLogic/>'staticlogic' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/SV/>'sv' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/SV/RationaleSV/>SV Dialect Rationale</a></li></ul></li></ul></li><li><a href=https://circt.llvm.org/docs/GettingStarted/>Getting Started with the CIRCT Project</a></li><li><a href=https://circt.llvm.org/docs/Passes/>Passes</a></li><li><a href=https://circt.llvm.org/docs/PyCDE/>PyCDE</a></li><li><a href=https://circt.llvm.org/docs/Scheduling/>Static scheduling infrastructure</a></li><li><a href=https://circt.llvm.org/docs/RationaleSymbols/>Symbol and Inner Symbol Rationale</a></li><li><a href=https://circt.llvm.org/docs/PythonBindings/>Using the Python Bindings</a></li><li><a href=https://circt.llvm.org/docs/VerilogGeneration/>Verilog and SystemVerilog Generation</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>