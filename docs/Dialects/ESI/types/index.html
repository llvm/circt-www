<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>ESI data types and communication types - CIRCT</title><meta name=description content="Circuit IR Compilers and Tools"><meta name=generator content="Hugo 0.101.0"><link href=https://circt.llvm.org/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://circt.llvm.org/docs/Dialects/ESI/types/><link rel=stylesheet href=https://circt.llvm.org/css/theme.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://circt.llvm.org/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://circt.llvm.org/js/bundle.js></script>
<script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script><style>:root{}</style></head><body><div class=container><header><h1><div><img src=https://circt.llvm.org//circt-logo.svg width=40px align=absmiddle>
CIRCT</div></h1><p class=description>Circuit IR Compilers and Tools</p></header><div class=global-menu><nav><ul><li class=parent><a href>Community<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=https://llvm.discourse.group/c/Projects-that-want-to-become-official-LLVM-Projects/circt/40>Forums</a></li><li class=child><a href=https://discord.gg/xS7Z362>Chat</a></li></ul></li><li class=parent><a href=https://github.com/llvm/circt/tree/main/>Source<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=/doxygen/>Doxygen</a></li><li class=child><a href=https://github.com/llvm/circt/tree/main/>GitHub</a></li></ul></li></ul></nav></div><div class=content-container><main><h1>ESI data types and communication types</h1><p>ESI has two different classes of MLIR types: ones which represent data on the
wires (data types) and ones which specify the type of communication. From a user
perspective, communication types aren&rsquo;t really types &ndash; this is just how the
communication style is modeled in MLIR and thus an implementation detail.</p><h2 id=data-types>Data types&nbsp;<a class=headline-hash href=#data-types>¶</a></h2><p>In addition to the types in the <code>hw</code> dialect, ESI will add few:</p><h3 id=void>Void&nbsp;<a class=headline-hash href=#void>¶</a></h3><p><code>void</code> translates to &ldquo;no data&rdquo;, meaning just a control signal.</p><p>Status: <strong>planned</strong></p><h3 id=lists>Lists&nbsp;<a class=headline-hash href=#lists>¶</a></h3><p>Lists are used to reason about variably-sized data. There are two types of
lists: those for which the size is known before transmission begins (a fixed
size list, or <strong>fixed_list</strong>), and those for which it isn&rsquo;t (a variably sized
list, or just <strong>list</strong>). <code>fixed_lists</code> are <strong>very</strong> roughly similar to a C
pointer/size pair (in that they contain a size upfront) whereas <code>lists</code> are
roughly similar to a simply singlely linked list wherein the size is not known
until one iterates through it.</p><p>Since it isn&rsquo;t yet clear what (if any) benefit <code>fixed_list</code> will provide, it is
not plan-of-record to implement it. <code>list</code> will be implemented in the future.</p><p>Status: <strong>planned</strong></p><h2 id=communication-types>Communication types&nbsp;<a class=headline-hash href=#communication-types>¶</a></h2><p>As stated above, communication &ldquo;types&rdquo; do not represent data on the wire;
rather, they speak to the signaling.</p><h2 id=channels>Channels&nbsp;<a class=headline-hash href=#channels>¶</a></h2><p>ESI &ldquo;channels&rdquo; are streaming connections upon which <em>messages</em> can be sent and
received. They are expressed by wrapping the type (e.g. <code>!esi.channel&lt;i5></code>) and
using it like any other value type.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mlir data-lang=mlir><span class=line><span class=cl>hw<span class=p>.</span>module <span class=nf>@add11</span><span class=p>(</span><span class=nv>%clk</span><span class=p>:</span> <span class=k>i1</span><span class=p>,</span> <span class=nv>%ints</span><span class=p>:</span> <span class=p>!</span>esi<span class=p>.</span>channel<span class=p>&lt;</span><span class=k>i32</span><span class=p>&gt;)</span> <span class=p>-&gt;</span> <span class=p>(</span><span class=nv>%outs</span><span class=p>:</span> <span class=p>!</span>esi<span class=p>.</span>channel<span class=p>&lt;</span><span class=k>i32</span><span class=p>&gt;</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  hw<span class=p>.</span>output <span class=nv>%ints</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The value which the channel is carrying must be (un)wrapped to access it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mlir data-lang=mlir><span class=line><span class=cl>hw<span class=p>.</span>module <span class=nf>@add11</span><span class=p>(</span><span class=nv>%clk</span><span class=p>:</span> <span class=k>i1</span><span class=p>,</span> <span class=nv>%ints</span><span class=p>:</span> <span class=p>!</span>esi<span class=p>.</span>channel<span class=p>&lt;</span><span class=k>i32</span><span class=p>&gt;)</span> <span class=p>-&gt;</span> <span class=p>(</span>mutatedInts<span class=p>:</span> <span class=p>!</span>esi<span class=p>.</span>channel<span class=p>&lt;</span><span class=k>i32</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>%i</span><span class=p>,</span> <span class=nv>%i_valid</span> <span class=p>=</span> esi<span class=p>.</span>unwrap<span class=p>.</span>vr <span class=nv>%ints</span><span class=p>,</span> <span class=nv>%rdy</span>
</span></span><span class=line><span class=cl>  <span class=nv>%c11</span> <span class=p>=</span> hw<span class=p>.</span><span class=kt>constant</span> <span class=m>11</span>
</span></span><span class=line><span class=cl>  <span class=nv>%m</span> <span class=p>=</span> comb<span class=p>.</span>add <span class=nv>%c11</span><span class=p>,</span> <span class=nv>%i</span>
</span></span><span class=line><span class=cl>  <span class=nv>%mutInts</span><span class=p>,</span> <span class=nv>%rdy</span> <span class=p>=</span> esi<span class=p>.</span>wrap<span class=p>.</span>vr <span class=nv>%m</span><span class=p>,</span> <span class=nv>%i_valid</span>
</span></span><span class=line><span class=cl>  hw<span class=p>.</span>output <span class=nv>%mutInts</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>[insert diagram of wrap/unwrap]</p><p>Status: <strong>complete and stable</strong> (for supported data types)</p><h2 id=memory-mapped-io>Memory-mapped IO&nbsp;<a class=headline-hash href=#memory-mapped-io>¶</a></h2><p><em>This section is not fully thought out or written about. It is certainly not
implemented. The text in this section should be considered initial thoughts.</em></p><p>Status: <strong>Planning</strong></p><h3 id=mmio-regions>MMIO Regions&nbsp;<a class=headline-hash href=#mmio-regions>¶</a></h3><p>The basic idea is to present ESI memory mapped <strong>regions</strong> exposed by
modules. There could be any number of these regions exposed and they
would work somewhat like input (request) / output (response) port pairs,
but with implicit request-response signaling and structure. The MMIO
space itself would be defined by a statically sized struct (so lists
would be disallowed), with address offsets implicitly or explicitly
defined. The method for base address assignment is yet to be decided.
These regions can support atomic reads or writes of arbitrary size or
limited size.</p><h3 id=mmio-requests-readwrite>MMIO Requests (read/write)&nbsp;<a class=headline-hash href=#mmio-requests-readwrite>¶</a></h3><p>Other modules connected to the same MMIO bus could specify read/write
requests in several ways:</p><ul><li>As a data window with blinds (or similar construct) specifying the
struct fields to read/write</li><li>As a list of address offsets and sizes or data to read/write</li></ul><p>Along with the request content, atomicity of the request would have to
be specified. The response on a read would correspond to the read
request &ndash; either a list of bytes read or a data window with the
requested data filled in. For a write, a simple acknowledgement or error
would suffice for the response.</p><h3 id=automatic-self-description>Automatic self-description&nbsp;<a class=headline-hash href=#automatic-self-description>¶</a></h3><p>An MMIO region&rsquo;s data type can be used to automatically generate a
self-describing software data type and an access API. Additionally, a per
MMIO bus table could be generated with the base addresses for each connected
region and a descriptor for each.</p><h3 id=software-access>Software access&nbsp;<a class=headline-hash href=#software-access>¶</a></h3><p>The MMIO struct would become a software struct which software could map
to the base address as a typed pointer. This way, software access would
be simpler (just a normal struct pointer dereference &ndash; e.g. p->field1)
and safer as it knows the correct address implicitly and the type of
that field. Additionally, if the MMIO region knows the processor&rsquo;s
endianness, it could respond in the correct endianness. How to initiate
an atomic read/write of multiple fields from software is undecided yet,
though there may be some merit to exposing data windows to software.</p><h3 id=additional-type-any>Additional Type: any&nbsp;<a class=headline-hash href=#additional-type-any>¶</a></h3><p>An MMIO space can be have type <strong>any</strong> to allow access to memory spaces which
are fundamentally untyped (e.g. memory-mapped host RAM). In this case, the
requestor can specify the type. For instance, to access 64-bit values the
requestor would send a request with a given address and specify a uint&lt;64> type
response or write. Alternatively, it could request a response or write type of
type struct ConfigSpace to specify it wants to read or write a configuration.</p><h3 id=implementation>Implementation&nbsp;<a class=headline-hash href=#implementation>¶</a></h3><p>The MMIO system <em>could</em> be implemented on top of the streaming portion.</p><h1 id=data-windows>Data windows</h1><p>By default, an entire message is guaranteed to be presented to the receiving
module in one clock cycle (excepting <code>lists</code>). For particularly large messages,
this is not ideal as it requires a data path equal to the size of the message.
Data windows specify which parts of a message a module accepts on each clock
cycle. For structs, they specify which members are accepted on which cycles. For
arrays and lists, they specify how many items can be accepted each clock cycle.</p><p>Data windows do not affect port compatibility. In other words, a designer can
connect ports using two different windows into the same data type. This can be
used to connect different modules with different bandwidths. A data window
merely specifies the logical &ldquo;gasket&rdquo; used to connect two differently sized
ports.</p><p>The MLIR representation of data windows has yet to be determined.</p><p>Status: <strong>planning</strong></p><div class=edit-meta><br></div><nav class=pagination><a class="nav nav-prev" href=https://circt.llvm.org/docs/Dialects/ESI/cosim/ title="ESI cosimulation model"><i class="fas fa-arrow-left" aria-hidden=true></i> Prev - ESI cosimulation model</a>
<a class="nav nav-next" href=https://circt.llvm.org/docs/Dialects/ESI/services/ title="ESI Global Services">Next - ESI Global Services <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://circt.llvm.org/>Home</a></li><li><a href=https://circt.llvm.org/talks/>Talks and Related Publications</a></li><li><a href=https://circt.llvm.org/getting_started/>Getting Started</a></li><li class="parent has-sub-menu"><a href=https://circt.llvm.org/docs/>Code Documentation<span class="mark opened">-</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://circt.llvm.org/docs/CommandGuide/>CommandGuide<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/CommandGuide/handshake-runner/>handshake-runner</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Charter/>CIRCT Charter</a></li><li class="parent has-sub-menu"><a href=https://circt.llvm.org/docs/Dialects/>Dialects<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/ESIAppID/></a></li><li><a href=https://circt.llvm.org/docs/Dialects/Arc/>'arc' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/Calyx/>'calyx' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/CHIRRTL/>'chirrtl' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Comb/>'comb' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Comb/RationaleComb/>`comb` Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/DC/>'dc' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/DC/RationaleDC/>DC Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Emit/>'emit' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Emit/RationaleEmit/>Emission (Emit) Dialect Rationale</a></li></ul></li><li class="parent has-sub-menu"><a href=https://circt.llvm.org/docs/Dialects/ESI/>'esi' Dialect<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/ESI/cosim/>ESI cosimulation model</a></li><li class=active><a href=https://circt.llvm.org/docs/Dialects/ESI/types/>ESI data types and communication types</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/services/>ESI Global Services</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/software_api/>ESI Software APIs</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/notes/>Miscellaneous Notes</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/RationaleESI/>The Elastic Silicon Interconnect dialect</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/>'firrtl' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/FIRRTLAnnotations/>FIRRTL Annotations</a></li><li><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/RationaleFIRRTL/>FIRRTL Dialect Rationale</a></li><li><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/FIRRTLIntrinsics/>Intrinsics</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/FSM/>'fsm' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/FSM/RationaleFSM/>FSM Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Handshake/>'handshake' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Handshake/RationaleHandshake/>Handshake Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/HW/>'hw' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/HW/RationaleHW/>HW Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/HWArith/>'hwarith' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/HWArith/RationaleHWArith/>HW Arith Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Ibis/>'ibis' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Ibis/RationaleIbis/>`ibis` Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/LLHD/>'llhd' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/LoopSchedule/>'loopschedule' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/LoopSchedule/LoopSchedule/>LoopSchedule Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/LTL/>'ltl' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/Moore/>'moore' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/MSFT/>'msft' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/OM/>'om' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/OM/RationaleOM/>Object Model Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Pipeline/>'pipeline' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Pipeline/RationalePipeline/>Pipeline Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Seq/>'seq' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Seq/RationaleSeq/>Seq(uential) Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/Sim/>'sim' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Sim/>'sim' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Sim/RationaleSim/>Simulation (Sim) Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/SSP/>'ssp' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/SSP/RationaleSSP/>SSP Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/SV/>'sv' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/SV/RationaleSV/>SV Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/SystemC/>'systemc' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/SystemC/RationaleSystemC/>SystemC Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/Verif/>'verif' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/Debug/>Debug Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Interop/>Interop Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Interop/RationaleInterop/>Interoperability Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/SMT/>SMT Dialect</a></li></ul></li><li><a href=https://circt.llvm.org/docs/ToolsWorkarounds/>EDA Tool Workarounds</a></li><li><a href=https://circt.llvm.org/docs/FormalVerification/>Formal Verification Tooling</a></li><li><a href=https://circt.llvm.org/docs/GettingStarted/>Getting Started with the CIRCT Project</a></li><li><a href=https://circt.llvm.org/docs/HLS/>HLS in CIRCT</a></li><li><a href=https://circt.llvm.org/docs/Passes/>Passes</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/PyCDE/>Python CIRCT Design Entry (PyCDE)<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/PyCDE/compiling/>Compiling CIRCT and PyCDE</a></li><li><a href=https://circt.llvm.org/docs/PyCDE/basics/>PyCDE Basics</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Scheduling/>Static scheduling infrastructure</a></li><li><a href=https://circt.llvm.org/docs/RationaleSymbols/>Symbol and Inner Symbol Rationale</a></li><li><a href=https://circt.llvm.org/docs/PythonBindings/>Using the Python Bindings</a></li><li><a href=https://circt.llvm.org/docs/VerilogGeneration/>Verilog and SystemVerilog Generation</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>