<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>PyCDE Basics - CIRCT</title><meta name=description content="Circuit IR Compilers and Tools"><meta name=generator content="Hugo 0.101.0"><link href=https://circt.llvm.org/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://circt.llvm.org/docs/PyCDE/basics/><link rel=stylesheet href=https://circt.llvm.org/css/theme.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://circt.llvm.org/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://circt.llvm.org/js/bundle.js></script>
<script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script><style>:root{}</style></head><body><div class=container><header><h1><div><img src=https://circt.llvm.org//circt-logo.svg width=40px align=absmiddle>
CIRCT</div></h1><p class=description>Circuit IR Compilers and Tools</p></header><div class=global-menu><nav><ul><li class=parent><a href>Community<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=https://llvm.discourse.group/c/Projects-that-want-to-become-official-LLVM-Projects/circt/40>Forums</a></li><li class=child><a href=https://discord.gg/xS7Z362>Chat</a></li></ul></li><li class=parent><a href=https://github.com/llvm/circt/tree/main/>Source<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=/doxygen/>Doxygen</a></li><li class=child><a href=https://github.com/llvm/circt/tree/main/>GitHub</a></li></ul></li></ul></nav></div><div class=content-container><main><h1>PyCDE Basics</h1><p>You know what&rsquo;s more difficult than forcing yourself to write documentation?
Maintaining it! We apologize for the inevitable inaccuracies.</p><h2 id=modules-generators-and-systems>Modules, Generators, and Systems&nbsp;<a class=headline-hash href=#modules-generators-and-systems>¶</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pycde</span> <span class=kn>import</span> <span class=n>Input</span><span class=p>,</span> <span class=n>Output</span><span class=p>,</span> <span class=n>Module</span><span class=p>,</span> <span class=n>System</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pycde</span> <span class=kn>import</span> <span class=n>generator</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pycde.types</span> <span class=kn>import</span> <span class=n>Bits</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrInts</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@generator</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>construct</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>c</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>a</span> <span class=o>|</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>system</span> <span class=o>=</span> <span class=n>System</span><span class=p>([</span><span class=n>OrInts</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;ExampleSystem&#34;</span><span class=p>,</span> <span class=n>output_directory</span><span class=o>=</span><span class=s2>&#34;exsys&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=o>.</span><span class=n>compile</span><span class=p>()</span>
</span></span></code></pre></div><p>Hardware modules extend <code>pycde.Module</code>. They define any number of typed inputs
and outputs by setting class members.</p><p>The <code>pycde.generator</code> decorator is used to denote the module construction code.
It is called once per module at <code>compile</code> time. Unlike standard python, the body
of the generator does not have access to instance members through <code>self</code> &ndash; just
ports. All of the output ports <strong>must</strong> be set.</p><p>In order to compile a hardware system, use <code>System</code> constructing it with the
class or list of classes which are the top modules. Other modules instantiated
in the generators get generated and emitted automatically and recursively (i.e.
only the root of the hierarchy needs to be given). <code>name</code> defaults to the top
module name. <code>output_directory</code> defaults to <code>name</code>. The <code>compile</code> method outputs
a &ldquo;build package&rdquo; containing the generated system into <code>output_directory</code>.</p><h2 id=instantiating-modules>Instantiating Modules&nbsp;<a class=headline-hash href=#instantiating-modules>¶</a></h2><p>Modules can be instantiated in other modules. The following example defines a module that instantiates the <code>AddInts</code> module defined above.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Top</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@generator</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>construct</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>or_ints</span> <span class=o>=</span> <span class=n>OrInts</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>c</span> <span class=o>=</span> <span class=n>or_ints</span><span class=o>.</span><span class=n>c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>system</span> <span class=o>=</span> <span class=n>System</span><span class=p>([</span><span class=n>Top</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;ExampleSystem&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=o>.</span><span class=n>compile</span><span class=p>()</span>
</span></span></code></pre></div><p>The constructor of a <code>Module</code> expects named keyword arguments for each input
port. These keyword arguments can be any PyCDE Signal. The above example uses
module inputs. Instances of <code>Module</code>s support named access to output port values
like <code>add_insts.c</code>. These output port values are PyCDE Signals, and can be use
to further connect modules or instantiate CIRCT dialect operations.</p><h2 id=types--signals>Types & Signals&nbsp;<a class=headline-hash href=#types--signals>¶</a></h2><p>Since CIRCT primarily targets hardware not software, it defines its own types.
PyCDE exposes them through the <code>pycde.types.Type</code> class hierarchy. PyCDE
signals represent values on the target device. Signals have a particular <code>Type</code>
(which is distinct from the signal objects&rsquo; Python <code>type</code>) stored in their
<code>type</code> instance member. <code>Type</code>s are heretofor referred to interchangeably as
&ldquo;PyCDE type&rdquo;, &ldquo;CIRCT type&rdquo;, or &ldquo;Type&rdquo;.</p><p>All signals extend the <code>pycde.signals.Signal</code> class, specialized by their Type.
The various specializations often include operator overrides to perform common
operations, as demonstrated in the hello world example&rsquo;s <code>|</code> bitwise or.</p><p>Note that the CIRCT type conveys information not just about the data type but
can also specify the signaling mechanism. In other words, a signal does not
necessarily imply standard wires (though it usually does).</p><p>** For CIRCT/MLIR developers: &ldquo;signals&rdquo; map 1:1 to MLIR Values.</p><h3 id=constants-and-python-object-conversion>Constants and Python object conversion&nbsp;<a class=headline-hash href=#constants-and-python-object-conversion>¶</a></h3><p>Some Python objects (e.g. int, dict, list) can be converted to constants in
hardware. PyCDE tries its best to make this automatic, but it sometimes needs to
know the Type. For instance, we don&rsquo;t know the desired bitwidth of an int. In
some cases we default to the required number of bits to represent a number, but
sometimes that fails.</p><p>In those cases, you must manually specify the Type. So <code>Bits(16)(i)</code> would
create a 16-bit constant of <code>i</code>.</p><h3 id=scalars>Scalars&nbsp;<a class=headline-hash href=#scalars>¶</a></h3><p><code>Bits(width)</code> models a bitvector. Allows indexing, slicing, bitwise operations, etc. No math operations.</p><p><code>UInt(width)</code>, <code>SInt(width)</code> math.</p><h3 id=arrays>Arrays&nbsp;<a class=headline-hash href=#arrays>¶</a></h3><p><code>Bits(32) * 10</code> creates an array of 32-bits of length 10.</p><p><code>Bits(32) * 10 * 12</code> creates an array of arrays.</p><h3 id=structs>Structs&nbsp;<a class=headline-hash href=#structs>¶</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pycde</span> <span class=kn>import</span> <span class=n>Input</span><span class=p>,</span> <span class=n>Output</span><span class=p>,</span> <span class=n>generator</span><span class=p>,</span> <span class=n>System</span><span class=p>,</span> <span class=n>Module</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pycde.types</span> <span class=kn>import</span> <span class=n>Bits</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pycde.signals</span> <span class=kn>import</span> <span class=n>Struct</span><span class=p>,</span> <span class=n>BitsSignal</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ExStruct</span><span class=p>(</span><span class=n>Struct</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>a</span><span class=p>:</span> <span class=n>Bits</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>b</span><span class=p>:</span> <span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>get_b_xor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>BitsSignal</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>^</span> <span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>)(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>StructExample</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>inp1</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>ExStruct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>out1</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>out2</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>out3</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>ExStruct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@generator</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>build</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>out1</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>inp1</span><span class=o>.</span><span class=n>get_b_xor</span><span class=p>(</span><span class=mi>5432</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>out2</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>inp1</span><span class=o>.</span><span class=n>a</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>out3</span> <span class=o>=</span> <span class=n>ExStruct</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>inp1</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=numpy-features>NumPy features&nbsp;<a class=headline-hash href=#numpy-features>¶</a></h3><p>PyCDE supports a subset of numpy array transformations (see <code>pycde/ndarray.py</code>)
that can be used to do complex reshaping and transformation of multidimensional
arrays.</p><p>The numpy functionality is provided by the <code>NDArray</code> class, which creates a view
on top of existing SSA values. Users may choose to perform transformations
directly on <code>ListSignal</code>s:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>M1</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>in1</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>dim</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>out</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>dim</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@generator</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>build</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>out</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>in1</span><span class=o>.</span><span class=n>transpose</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=mi>16</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># Under the hood, this resolves to</span>
</span></span><span class=line><span class=cl>    <span class=c1># Matrix(from_value=</span>
</span></span><span class=line><span class=cl>    <span class=c1>#    Matrix(from_value=ports.in1).transpose((1,0)).to_circt())</span>
</span></span><span class=line><span class=cl>    <span class=c1>#  .reshape(16, 2).to_circt()</span>
</span></span></code></pre></div><p>or manually manage a <code>NDArray</code> object.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>M1</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>in1</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>dim</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>out</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>dim</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@generator</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>build</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>NDArray</span><span class=p>(</span><span class=n>from_value</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>in1</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=mi>16</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>out</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>to_circt</span><span class=p>()</span>
</span></span></code></pre></div><p>Manually managing the NDArray object allows for postponing materialization
(<code>to_circt()</code>) until all transformations have been applied. In short, this
allows us to do as many transformations as possible in software, before emitting
IR. Note however, that this might reduce debugability of the generated hardware
due to the lack of <code>sv.wire</code>s in between each matrix transformation.</p><p>For further usage examples, see <code>PyCDE/test/test_ndarray.py</code>, and inspect
<code>ListSignal</code> in <code>pycde/signals.py</code> for the full list of implemented numpy
functions.</p><h2 id=external-modules>External Modules&nbsp;<a class=headline-hash href=#external-modules>¶</a></h2><p>External modules are how PyCDE and CIRCT support interacting with existing
System Verilog or Verilog modules. They must be declared and the ports must
match the externally defined implementation in SystemVerilog or other language.
We have no way of checking that they do indeed match so it&rsquo;ll be up to the EDA
synthesizer (and they generally do a poor job reporting mismatches).</p><p>In PyCDE, an external module is any module without a generator.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>MulInts</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>module_name</span> <span class=o>=</span> <span class=s2>&#34;MyMultiplier&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>Bits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span></code></pre></div><p>The <code>MyMultiplier</code> module is declared in the default output file, <code>ExampleSystem/ExampleSystem.sv</code>.</p><h2 id=parameterized-modules>Parameterized modules&nbsp;<a class=headline-hash href=#parameterized-modules>¶</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pycde</span> <span class=kn>import</span> <span class=n>modparams</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@modparams</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>AddInts</span><span class=p>(</span><span class=n>width</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>AddInts</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=n>width</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=n>width</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=n>width</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@generator</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>build</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=bp>self</span><span class=o>.</span><span class=n>c</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>a</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>AddInts</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Top</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>a</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>b</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>c</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=mi>33</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@generator</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>construct</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>add_ints_m</span> <span class=o>=</span> <span class=n>AddInts</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add_ints</span> <span class=o>=</span> <span class=n>add_ints_m</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>c</span> <span class=o>=</span> <span class=n>add_ints</span><span class=o>.</span><span class=n>c</span>
</span></span></code></pre></div><p>In order to &ldquo;parameterize&rdquo; a module, simply return one from a function. Said
function must be decorated with <code>modparams</code> to inform PyCDE that the returned
module is a parameterized one. The <code>modparams</code> decorator does several things
including: (1) memoizing the parameterization function, and (2) automatically
derive a module name which includes the parameter values (for module name
uniqueness).</p><p>PyCDE does not produce parameterized SystemVerilog modules! The specialization
happens with Python code, which is far more powerful than SystemVerilog
parameterization constructs.</p><h2 id=external-parameterized-modules>External parameterized modules&nbsp;<a class=headline-hash href=#external-parameterized-modules>¶</a></h2><p>Just like internally defined parameterized modules, leave off the generator and
PyCDE will output SystemVerilog instantations with the module parameters. The
parameter types are best effort based on the first instantiation encountered.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pycde</span> <span class=kn>import</span> <span class=n>modparams</span><span class=p>,</span> <span class=n>Module</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@modparams</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>AddInts</span><span class=p>(</span><span class=n>width</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>AddInts</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=n>width</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=n>width</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=n>width</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>AddInts</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Top</span><span class=p>(</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>a</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>b</span> <span class=o>=</span> <span class=n>Input</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>c</span> <span class=o>=</span> <span class=n>Output</span><span class=p>(</span><span class=n>UInt</span><span class=p>(</span><span class=mi>33</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@generator</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>construct</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>add_ints_m</span> <span class=o>=</span> <span class=n>AddInts</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add_ints</span> <span class=o>=</span> <span class=n>add_ints_m</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>c</span> <span class=o>=</span> <span class=n>add_ints</span><span class=o>.</span><span class=n>c</span>
</span></span></code></pre></div><p>For the instantiation produces:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=line><span class=cl>  <span class=n>AddInts</span> <span class=p>#(</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>width</span><span class=p>(</span><span class=mh>64</span><span class=mi>&#39;d32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=n>AddInts</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>a</span> <span class=p>(</span><span class=n>a</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>b</span> <span class=p>(</span><span class=n>b</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>c</span> <span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span></code></pre></div><h2 id=using-circt-dialects-directly-instead-of-with-pycde-syntactic-sugar>Using CIRCT dialects directly (instead of with PyCDE syntactic sugar)&nbsp;<a class=headline-hash href=#using-circt-dialects-directly-instead-of-with-pycde-syntactic-sugar>¶</a></h2><p>Generally speaking, don&rsquo;t.</p><p>One can directly instantiate CIRCT operations through
<code>pycde.dialects.&lt;dialect_name></code>. The CIRCT operations contained therein provide
thin wrappers around the CIRCT operations to adapt them to
<a href=#signals>PyCDE
Signals</a> by overriding each operation&rsquo;s constructor. This
auto-wrapper, however, does not always &ldquo;just work&rdquo; depending on the complexity
of the operation it is attemption to wrap. So don&rsquo;t use it unless you know what
you&rsquo;re doing. User beware. Warranty voided. Caveat emptor. etc.</p><div class=edit-meta><br></div><nav class=pagination><a class="nav nav-prev" href=https://circt.llvm.org/docs/PyCDE/compiling/ title="Compiling CIRCT and PyCDE"><i class="fas fa-arrow-left" aria-hidden=true></i> Prev - Compiling CIRCT and PyCDE</a>
<a class="nav nav-next" href=https://circt.llvm.org/docs/Scheduling/ title="Static scheduling infrastructure">Next - Static scheduling infrastructure <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://circt.llvm.org/>Home</a></li><li><a href=https://circt.llvm.org/talks/>Talks and Related Publications</a></li><li><a href=https://circt.llvm.org/getting_started/>Getting Started</a></li><li class="parent has-sub-menu"><a href=https://circt.llvm.org/docs/>Code Documentation<span class="mark opened">-</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://circt.llvm.org/docs/CommandGuide/>CommandGuide<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/CommandGuide/handshake-runner/>handshake-runner</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Charter/>CIRCT Charter</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/>Dialects<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/ESIAppID/></a></li><li><a href=https://circt.llvm.org/docs/Dialects/Arc/>'arc' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/Calyx/>'calyx' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/CHIRRTL/>'chirrtl' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Comb/>'comb' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Comb/RationaleComb/>`comb` Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/DC/>'dc' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/OM/RationaleOM/>Object Model Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Emit/>'emit' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/LoopSchedule/LoopSchedule/>LoopSchedule Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/ESI/>'esi' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/ESI/cosim/>ESI cosimulation model</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/types/>ESI data types and communication types</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/services/>ESI Global Services</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/software_api/>ESI Software APIs</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/notes/>Miscellaneous Notes</a></li><li><a href=https://circt.llvm.org/docs/Dialects/ESI/RationaleESI/>The Elastic Silicon Interconnect dialect</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/>'firrtl' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/FIRRTLAnnotations/>FIRRTL Annotations</a></li><li><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/RationaleFIRRTL/>FIRRTL Dialect Rationale</a></li><li><a href=https://circt.llvm.org/docs/Dialects/FIRRTL/FIRRTLIntrinsics/>Intrinsics</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/FSM/>'fsm' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/FSM/RationaleFSM/>FSM Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Handshake/>'handshake' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Handshake/RationaleHandshake/>Handshake Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/HW/>'hw' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/HW/RationaleHW/>HW Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/HWArith/>'hwarith' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/HWArith/RationaleHWArith/>HW Arith Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Ibis/>'ibis' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Ibis/RationaleIbis/>`ibis` Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/LLHD/>'llhd' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/LoopSchedule/>'loopschedule' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/LoopSchedule/LoopSchedule/>LoopSchedule Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/LTL/>'ltl' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/Moore/>'moore' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/MSFT/>'msft' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/OM/>'om' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/OM/RationaleOM/>Object Model Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Pipeline/>'pipeline' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Pipeline/RationalePipeline/>Pipeline Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Seq/>'seq' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Seq/RationaleSeq/>Seq(uential) Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/Sim/>'sim' Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Sim/>'sim' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Sim/RationaleSim/>Simulation (Sim) Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/SSP/>'ssp' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/SSP/RationaleSSP/>SSP Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/SV/>'sv' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/SV/RationaleSV/>SV Dialect Rationale</a></li></ul></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/SystemC/>'systemc' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/SystemC/RationaleSystemC/>SystemC Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/Verif/>'verif' Dialect</a></li><li><a href=https://circt.llvm.org/docs/Dialects/Debug/>Debug Dialect</a></li><li class=has-sub-menu><a href=https://circt.llvm.org/docs/Dialects/Interop/>Interop Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/Dialects/Interop/RationaleInterop/>Interoperability Dialect Rationale</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Dialects/SMT/>SMT Dialect</a></li></ul></li><li><a href=https://circt.llvm.org/docs/ToolsWorkarounds/>EDA Tool Workarounds</a></li><li><a href=https://circt.llvm.org/docs/FormalVerification/>Formal Verification Tooling</a></li><li><a href=https://circt.llvm.org/docs/GettingStarted/>Getting Started with the CIRCT Project</a></li><li><a href=https://circt.llvm.org/docs/HLS/>HLS in CIRCT</a></li><li><a href=https://circt.llvm.org/docs/Passes/>Passes</a></li><li class="parent has-sub-menu"><a href=https://circt.llvm.org/docs/PyCDE/>Python CIRCT Design Entry (PyCDE)<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://circt.llvm.org/docs/PyCDE/compiling/>Compiling CIRCT and PyCDE</a></li><li class=active><a href=https://circt.llvm.org/docs/PyCDE/basics/>PyCDE Basics</a></li></ul></li><li><a href=https://circt.llvm.org/docs/Scheduling/>Static scheduling infrastructure</a></li><li><a href=https://circt.llvm.org/docs/RationaleSymbols/>Symbol and Inner Symbol Rationale</a></li><li><a href=https://circt.llvm.org/docs/PythonBindings/>Using the Python Bindings</a></li><li><a href=https://circt.llvm.org/docs/VerilogGeneration/>Verilog and SystemVerilog Generation</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>