<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CIRCT: /home/runner/work/circt-www/circt-www/circt_src/lib/Dialect/ESI/Passes/ESILowerToHW.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CIRCT
   &#160;<span id="projectnumber">19.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_1a25ec519b6c1121408b67cc33ce3f15.html">Dialect</a></li><li class="navelem"><a class="el" href="dir_8547f46dd3e886e73fec95a7c794e399.html">ESI</a></li><li class="navelem"><a class="el" href="dir_d0841443981d4f14e14f5ec543efdc67.html">Passes</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ESILowerToHW.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ESILowerToHW_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- ESILowerToHW.cpp - Lower ESI to HW -----------------------*- C++ -*-===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// Lower to HW/SV conversions and pass.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;../PassDetails.h&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CombOps_8h.html">circt/Dialect/Comb/CombOps.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="APIUtilities_8h.html">circt/Dialect/ESI/APIUtilities.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ESIOps_8h.html">circt/Dialect/ESI/ESIOps.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="HWOps_8h.html">circt/Dialect/HW/HWOps.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SVOps_8h.html">circt/Dialect/SV/SVOps.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SeqOps_8h.html">circt/Dialect/Seq/SeqOps.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BackedgeBuilder_8h.html">circt/Support/BackedgeBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVM_8h.html">circt/Support/LLVM.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SymCache_8h.html">circt/Support/SymCache.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;mlir/Transforms/DialectConversion.h&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;llvm/ADT/StringExtras.h&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;llvm/ADT/TypeSwitch.h&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;llvm/Support/JSON.h&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacecirct.html">circt</a>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacecirct_1_1esi.html">circt::esi</a>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacecirct_1_1esi_1_1detail.html">circt::esi::detail</a>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacecirct_1_1hw.html">circt::hw</a>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacecirct_1_1sv.html">circt::sv</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">/// Lower PipelineStageOp ops to an HW implementation. Unwrap and re-wrap</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">/// appropriately. Another conversion will take care merging the resulting</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">/// adjacent wrap/unwrap ops.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"></span><span class="keyword">struct </span>PipelineStageLowering : <span class="keyword">public</span> <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;PipelineStageOp&gt; {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  PipelineStageLowering(<a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html">ESIHWBuilder</a> &amp;<a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>, MLIRContext *<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      : <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>), <a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>(<a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>) {}</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keyword">using</span> OpConversionPattern::OpConversionPattern;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  matchAndRewrite(PipelineStageOp stage, OpAdaptor adaptor,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html">ESIHWBuilder</a> &amp;<a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;};</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;LogicalResult PipelineStageLowering::matchAndRewrite(</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    PipelineStageOp stage, OpAdaptor adaptor,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keyword">auto</span> loc = stage.getLoc();</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keyword">auto</span> chPort = stage.getInput().getType().dyn_cast&lt;ChannelType&gt;();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordflow">if</span> (!chPort)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">return</span> rewriter.notifyMatchFailure(stage, <span class="stringliteral">&quot;stage had wrong type&quot;</span>);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  Operation *symTable = stage-&gt;getParentWithTrait&lt;OpTrait::SymbolTable&gt;();</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">auto</span> stageModule = <a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>.declareStage(symTable, stage);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> = <a class="code" href="namespacecirct_1_1hw.html#ac9803400d01843629490fcba24fed85d">circt::hw::getBitWidth</a>(chPort.getInner());</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  ArrayAttr stageParams =</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>.getStageParameterList(rewriter.getUI32IntegerAttr(<a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a>));</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">// Unwrap the channel. The ready signal is a Value we haven&#39;t created yet,</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">// so create a temp value and replace it later. Give this constant an</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">// odd-looking type to make debugging easier.</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="classcirct_1_1BackedgeBuilder.html">circt::BackedgeBuilder</a> back(rewriter, loc);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="classcirct_1_1Backedge.html">circt::Backedge</a> wrapReady = back.get(rewriter.getI1Type());</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keyword">auto</span> <a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a> =</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      rewriter.create&lt;UnwrapValidReadyOp&gt;(loc, stage.getInput(), wrapReady);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  StringRef pipeStageName = <span class="stringliteral">&quot;pipelineStage&quot;</span>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> name = stage-&gt;getAttrOfType&lt;StringAttr&gt;(<span class="stringliteral">&quot;name&quot;</span>))</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    pipeStageName = name.getValue();</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// Instantiate the &quot;ESI_PipelineStage&quot; external module.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="classcirct_1_1Backedge.html">circt::Backedge</a> stageReady = back.get(rewriter.getI1Type());</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  llvm::SmallVector&lt;Value&gt; operands = {stage.getClk(), stage.getRst()};</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  operands.push_back(<a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>.getRawOutput());</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  operands.push_back(<a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>.getValid());</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  operands.push_back(stageReady);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keyword">auto</span> stageInst = rewriter.create&lt;hw::InstanceOp&gt;(</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      loc, stageModule, pipeStageName, operands, stageParams);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keyword">auto</span> stageInstResults = stageInst.getResults();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// Set a_ready (from the unwrap) back edge correctly to its output from</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">// stage.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  wrapReady.<a class="code" href="classcirct_1_1Backedge.html#af1917cf5c65da45ab8e874b6d7464a26">setValue</a>(stageInstResults[0]);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  Value x, xValid;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  x = stageInstResults[1];</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  xValid = stageInstResults[2];</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// Wrap up the output of the HW stage module.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keyword">auto</span> <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a> = rewriter.create&lt;WrapValidReadyOp&gt;(</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      loc, chPort, rewriter.getI1Type(), x, xValid);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// Set the stages x_ready backedge correctly.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  stageReady.<a class="code" href="classcirct_1_1Backedge.html#af1917cf5c65da45ab8e874b6d7464a26">setValue</a>(<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getReady());</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  rewriter.replaceOp(stage, <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getChanOutput());</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword">struct </span>NullSourceOpLowering : <span class="keyword">public</span> <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;NullSourceOp&gt; {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  NullSourceOpLowering(MLIRContext *<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>) : <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>) {}</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keyword">using</span> OpConversionPattern::OpConversionPattern;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  matchAndRewrite(NullSourceOp nullop, OpAdaptor adaptor,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;};</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;LogicalResult NullSourceOpLowering::matchAndRewrite(</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    NullSourceOp nullop, OpAdaptor adaptor,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keyword">auto</span> <a class="code" href="namespacecirct_1_1esi.html#a989620eb18fae9f9d4ed78419b7a9efd">innerType</a> = nullop.getOut().getType().cast&lt;ChannelType&gt;().getInner();</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  Location loc = nullop.getLoc();</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  int64_t <a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> = <a class="code" href="namespacecirct_1_1hw.html#ac9803400d01843629490fcba24fed85d">hw::getBitWidth</a>(<a class="code" href="namespacecirct_1_1esi.html#a989620eb18fae9f9d4ed78419b7a9efd">innerType</a>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> == -1)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span> rewriter.notifyMatchFailure(</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        nullop, <span class="stringliteral">&quot;NullOp lowering only supports hw types&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keyword">auto</span> valid =</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      rewriter.create&lt;<a class="code" href="classhw_1_1ConstantOp.html">hw::ConstantOp</a>&gt;(nullop.getLoc(), rewriter.getI1Type(), 0);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keyword">auto</span> zero =</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      rewriter.<a class="code" href="classhw_1_1ConstantOp.html#a8904bc93000d6ef24ace4587a4d0bd7a">create</a>&lt;<a class="code" href="classhw_1_1ConstantOp.html">hw::ConstantOp</a>&gt;(loc, rewriter.getIntegerType(<a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a>), 0);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keyword">auto</span> typedZero = rewriter.<a class="code" href="classhw_1_1ConstantOp.html#a8904bc93000d6ef24ace4587a4d0bd7a">create</a>&lt;<a class="code" href="classhw_1_1BitcastOp.html">hw::BitcastOp</a>&gt;(loc, <a class="code" href="namespacecirct_1_1esi.html#a989620eb18fae9f9d4ed78419b7a9efd">innerType</a>, zero);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keyword">auto</span> <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a> = rewriter.create&lt;WrapValidReadyOp&gt;(loc, typedZero, valid);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>-&gt;setAttr(<span class="stringliteral">&quot;name&quot;</span>, rewriter.getStringAttr(<span class="stringliteral">&quot;nullsource&quot;</span>));</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  rewriter.replaceOp(nullop, {<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getChanOutput()});</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">/// Eliminate back-to-back wrap-unwraps to reduce the number of ESI channels.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"></span><span class="keyword">struct </span>RemoveWrapUnwrap : <span class="keyword">public</span> ConversionPattern {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  RemoveWrapUnwrap(MLIRContext *context)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      : ConversionPattern(MatchAnyOpTypeTag(), <span class="comment">/*benefit=*/</span>1, context) {}</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  matchAndRewrite(Operation *op, ArrayRef&lt;Value&gt; operands,</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                  ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    Value valid, ready, <a class="code" href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba8d777f385d3dfec8815d20f7496026dc">data</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    WrapValidReadyOp <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a> = dyn_cast&lt;WrapValidReadyOp&gt;(op);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    UnwrapValidReadyOp <a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a> = dyn_cast&lt;UnwrapValidReadyOp&gt;(op);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getChanOutput().getUsers().empty()) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keyword">auto</span> c1 = rewriter.create&lt;<a class="code" href="classhw_1_1ConstantOp.html">hw::ConstantOp</a>&gt;(<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getLoc(),</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                                                  rewriter.getI1Type(), 1);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        rewriter.replaceOp(<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, {<span class="keyword">nullptr</span>, c1});</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getChanOutput().hasOneUse() ||</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;          !(<a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a> = dyn_cast&lt;UnwrapValidReadyOp&gt;(</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getChanOutput().use_begin()-&gt;getOwner())))</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">return</span> rewriter.notifyMatchFailure(</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, <span class="stringliteral">&quot;This conversion only supports wrap-unwrap back-to-back. &quot;</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                  <span class="stringliteral">&quot;Could not find &#39;unwrap&#39;.&quot;</span>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <a class="code" href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba8d777f385d3dfec8815d20f7496026dc">data</a> = operands[0];</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      valid = operands[1];</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      ready = <a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>.getReady();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a> = dyn_cast&lt;WrapValidReadyOp&gt;(operands[0].getDefiningOp());</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">return</span> rewriter.notifyMatchFailure(</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            operands[0].getDefiningOp(),</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="stringliteral">&quot;This conversion only supports wrap-unwrap back-to-back. &quot;</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="stringliteral">&quot;Could not find &#39;wrap&#39;.&quot;</span>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      valid = <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getValid();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <a class="code" href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba8d777f385d3dfec8815d20f7496026dc">data</a> = <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getRawInput();</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      ready = operands[1];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keywordflow">return</span> failure();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getChanOutput().hasOneUse())</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">return</span> rewriter.notifyMatchFailure(<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, [](Diagnostic &amp;d) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        d &lt;&lt; <span class="stringliteral">&quot;This conversion only supports wrap-unwrap back-to-back. &quot;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;             <span class="stringliteral">&quot;Wrap didn&#39;t have exactly one use.&quot;</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      });</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    rewriter.replaceOp(<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, {<span class="keyword">nullptr</span>, ready});</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    rewriter.replaceOp(<a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>, {<a class="code" href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba8d777f385d3dfec8815d20f7496026dc">data</a>, valid});</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;};</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">/// Use the op canonicalizer to lower away the op. Assumes the canonicalizer</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">/// deletes the op.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Op&gt;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="keyword">struct </span>CanonicalizerOpLowering : <span class="keyword">public</span> <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;Op&gt; {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  CanonicalizerOpLowering(MLIRContext *<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>) : <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;Op&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>) {}</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  matchAndRewrite(Op op, <span class="keyword">typename</span> Op::Adaptor adaptor,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span> {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (failed(Op::canonicalize(op, rewriter)))</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">return</span> rewriter.notifyMatchFailure(op-&gt;getLoc(), <span class="stringliteral">&quot;canonicalizer failed&quot;</span>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;};</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keyword">struct </span>ESItoHWPass : <span class="keyword">public</span> LowerESItoHWBase&lt;ESItoHWPass&gt; {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordtype">void</span> runOnOperation() <span class="keyword">override</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;};</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">/// Lower a `wrap.iface` to `wrap.vr` by extracting the wires then feeding the</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">/// new `wrap.vr`.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"></span><span class="keyword">struct </span>WrapInterfaceLower : <span class="keyword">public</span> <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;WrapSVInterfaceOp&gt; {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keyword">using</span> OpConversionPattern::OpConversionPattern;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  matchAndRewrite(WrapSVInterfaceOp <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, OpAdaptor adaptor,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;};</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;LogicalResult</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;WrapInterfaceLower::matchAndRewrite(WrapSVInterfaceOp <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, OpAdaptor adaptor,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                    ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keyword">auto</span> operands = adaptor.getOperands();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">if</span> (operands.size() != 1)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">return</span> rewriter.notifyMatchFailure(<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, [&amp;operands](Diagnostic &amp;d) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      d &lt;&lt; <span class="stringliteral">&quot;wrap.iface has 1 argument. Got &quot;</span> &lt;&lt; operands.size() &lt;&lt; <span class="stringliteral">&quot;operands&quot;</span>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    });</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keyword">auto</span> sinkModport = dyn_cast&lt;GetModportOp&gt;(operands[0].getDefiningOp());</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">if</span> (!sinkModport)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">return</span> failure();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keyword">auto</span> ifaceInstance =</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      dyn_cast&lt;InterfaceInstanceOp&gt;(sinkModport.getIface().getDefiningOp());</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">if</span> (!ifaceInstance)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">return</span> failure();</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keyword">auto</span> loc = <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>.getLoc();</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keyword">auto</span> validSignal = rewriter.create&lt;ReadInterfaceSignalOp&gt;(</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      loc, ifaceInstance, <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a352855bb285ae6506969acc79563047c">ESIHWBuilder::validStr</a>);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  Value dataSignal;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  dataSignal = rewriter.create&lt;ReadInterfaceSignalOp&gt;(loc, ifaceInstance,</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                                      <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a5e2cc8a456f02960e94d08cae22e92b3">ESIHWBuilder::dataStr</a>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keyword">auto</span> wrapVR = rewriter.create&lt;WrapValidReadyOp&gt;(loc, dataSignal, validSignal);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  rewriter.create&lt;AssignInterfaceSignalOp&gt;(</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      loc, ifaceInstance, <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a583938599a6e69c52460fc75508820f1">ESIHWBuilder::readyStr</a>, wrapVR.getReady());</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  rewriter.replaceOp(<a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, {wrapVR.getChanOutput()});</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">/// Lower an unwrap interface to just extract the wires and feed them into an</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">/// `unwrap.vr`.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"></span><span class="keyword">struct </span>UnwrapInterfaceLower : <span class="keyword">public</span> <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;UnwrapSVInterfaceOp&gt; {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  UnwrapInterfaceLower(MLIRContext *<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>) : <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>) {}</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keyword">using</span> OpConversionPattern::OpConversionPattern;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  matchAndRewrite(UnwrapSVInterfaceOp <a class="code" href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a>, OpAdaptor adaptor,</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;};</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;LogicalResult UnwrapInterfaceLower::matchAndRewrite(</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    UnwrapSVInterfaceOp <a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>, OpAdaptor adaptor,</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keyword">auto</span> operands = adaptor.getOperands();</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">if</span> (operands.size() != 2)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">return</span> rewriter.notifyMatchFailure(<a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>, [&amp;operands](Diagnostic &amp;d) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      d &lt;&lt; <span class="stringliteral">&quot;Unwrap.iface has 2 arguments. Got &quot;</span> &lt;&lt; operands.size()</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;operands&quot;</span>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    });</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keyword">auto</span> sourceModport = dyn_cast&lt;GetModportOp&gt;(operands[1].getDefiningOp());</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">if</span> (!sourceModport)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">return</span> failure();</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keyword">auto</span> ifaceInstance =</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      dyn_cast&lt;InterfaceInstanceOp&gt;(sourceModport.getIface().getDefiningOp());</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordflow">if</span> (!ifaceInstance)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">return</span> failure();</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keyword">auto</span> loc = <a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>.getLoc();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keyword">auto</span> readySignal = rewriter.create&lt;ReadInterfaceSignalOp&gt;(</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      loc, ifaceInstance, <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a583938599a6e69c52460fc75508820f1">ESIHWBuilder::readyStr</a>);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keyword">auto</span> unwrapVR =</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      rewriter.create&lt;UnwrapValidReadyOp&gt;(loc, operands[0], readySignal);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  rewriter.create&lt;AssignInterfaceSignalOp&gt;(</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      loc, ifaceInstance, <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a352855bb285ae6506969acc79563047c">ESIHWBuilder::validStr</a>, unwrapVR.getValid());</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  rewriter.create&lt;AssignInterfaceSignalOp&gt;(</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      loc, ifaceInstance, <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a5e2cc8a456f02960e94d08cae22e92b3">ESIHWBuilder::dataStr</a>, unwrapVR.getRawOutput());</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  rewriter.eraseOp(<a class="code" href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;}</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">/// Lower `CosimEndpointOp` ops to a SystemVerilog extern module and a Capnp</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">/// gasket op.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment"></span><span class="keyword">struct </span>CosimToHostLowering : <span class="keyword">public</span> <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;CosimToHostEndpointOp&gt; {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  CosimToHostLowering(<a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html">ESIHWBuilder</a> &amp;b)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      : <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>(b.getContext(), 1), <a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>(b) {}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keyword">using</span> OpConversionPattern::OpConversionPattern;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  matchAndRewrite(CosimToHostEndpointOp, OpAdaptor adaptor,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html">ESIHWBuilder</a> &amp;<a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;};</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;LogicalResult CosimToHostLowering::matchAndRewrite(</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    CosimToHostEndpointOp ep, OpAdaptor adaptor,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keyword">auto</span> loc = ep.getLoc();</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a> = rewriter.getContext();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <a class="code" href="classcirct_1_1BackedgeBuilder.html">circt::BackedgeBuilder</a> bb(rewriter, loc);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  Value toHost = adaptor.getToHost();</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  Type type = toHost.getType();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  uint64_t <a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> = <a class="code" href="namespacecirct_1_1esi_1_1detail.html#a8294216b8309ec352bf4c5da5a5fd47e">getWidth</a>(type);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// Set all the parameters.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  SmallVector&lt;Attribute, 8&gt; params;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  params.push_back(<a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ParamDeclAttr::get</a>(<span class="stringliteral">&quot;ENDPOINT_ID&quot;</span>, ep.getIdAttr()));</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  params.push_back(<a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ParamDeclAttr::get</a>(<span class="stringliteral">&quot;TO_HOST_TYPE_ID&quot;</span>, <a class="code" href="namespacecirct_1_1esi_1_1detail.html#a9b554f78a3b4315d89c337dabd6a1851">getTypeID</a>(type)));</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  params.push_back(<a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ParamDeclAttr::get</a>(</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="stringliteral">&quot;TO_HOST_SIZE_BITS&quot;</span>, rewriter.getI32IntegerAttr(<a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> &gt; 0 ? <a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> : 1)));</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="comment">// Set up the egest route to drive the EP&#39;s toHost ports.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keyword">auto</span> sendReady = bb.get(rewriter.getI1Type());</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  UnwrapValidReadyOp unwrapSend =</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      rewriter.create&lt;UnwrapValidReadyOp&gt;(loc, toHost, sendReady);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  Value castedSendData;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> &gt; 0)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    castedSendData = rewriter.create&lt;<a class="code" href="classhw_1_1BitcastOp.html">hw::BitcastOp</a>&gt;(</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        loc, rewriter.getIntegerType(<a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a>), unwrapSend.getRawOutput());</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    castedSendData = rewriter.<a class="code" href="classhw_1_1BitcastOp.html#afba533108c6671d4d522a19416084d13">create</a>&lt;<a class="code" href="classhw_1_1ConstantOp.html">hw::ConstantOp</a>&gt;(</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        loc, rewriter.getIntegerType(1), rewriter.getBoolAttr(<span class="keyword">false</span>));</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="comment">// Build or get the cached Cosim Endpoint module parameterization.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  Operation *symTable = ep-&gt;getParentWithTrait&lt;OpTrait::SymbolTable&gt;();</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  HWModuleExternOp endpoint =</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>.declareCosimEndpointToHostModule(symTable);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="comment">// Create replacement Cosim_Endpoint instance.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  Value operands[] = {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      adaptor.getClk(),</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      adaptor.getRst(),</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      unwrapSend.getValid(),</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      castedSendData,</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  };</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keyword">auto</span> cosimEpModule = rewriter.<a class="code" href="classhw_1_1BitcastOp.html#afba533108c6671d4d522a19416084d13">create</a>&lt;hw::InstanceOp&gt;(</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      loc, endpoint, ep.getIdAttr(), operands, <a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ArrayAttr::get</a>(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>, params));</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  sendReady.setValue(cosimEpModule.getResult(0));</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="comment">// Replace the CosimEndpointOp op.</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  rewriter.eraseOp(ep);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">/// Lower `CosimEndpointOp` ops to a SystemVerilog extern module and a Capnp</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">/// gasket op.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"></span><span class="keyword">struct </span>CosimFromHostLowering</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    : <span class="keyword">public</span> <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;CosimFromHostEndpointOp&gt; {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  CosimFromHostLowering(<a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html">ESIHWBuilder</a> &amp;b)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      : <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>(b.getContext(), 1), <a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>(b) {}</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keyword">using</span> OpConversionPattern::OpConversionPattern;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  matchAndRewrite(CosimFromHostEndpointOp, OpAdaptor adaptor,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html">ESIHWBuilder</a> &amp;<a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;};</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;LogicalResult CosimFromHostLowering::matchAndRewrite(</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    CosimFromHostEndpointOp ep, OpAdaptor adaptor,</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keyword">auto</span> loc = ep.getLoc();</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a> = rewriter.getContext();</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <a class="code" href="classcirct_1_1BackedgeBuilder.html">circt::BackedgeBuilder</a> bb(rewriter, loc);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  ChannelType type = ep.getFromHost().getType();</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  uint64_t <a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> = <a class="code" href="namespacecirct_1_1esi_1_1detail.html#a8294216b8309ec352bf4c5da5a5fd47e">getWidth</a>(type);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="comment">// Set all the parameters.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  SmallVector&lt;Attribute, 8&gt; params;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  params.push_back(<a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ParamDeclAttr::get</a>(<span class="stringliteral">&quot;ENDPOINT_ID&quot;</span>, ep.getIdAttr()));</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  params.push_back(<a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ParamDeclAttr::get</a>(<span class="stringliteral">&quot;FROM_HOST_TYPE_ID&quot;</span>, <a class="code" href="namespacecirct_1_1esi_1_1detail.html#a9b554f78a3b4315d89c337dabd6a1851">getTypeID</a>(type)));</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  params.push_back(</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ParamDeclAttr::get</a>(<span class="stringliteral">&quot;FROM_HOST_SIZE_BITS&quot;</span>,</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                         rewriter.getI32IntegerAttr(<a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> &gt; 0 ? <a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> : 1)));</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">// Get information necessary for injest path.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keyword">auto</span> recvReady = bb.get(rewriter.getI1Type());</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">// Build or get the cached Cosim Endpoint module parameterization.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  Operation *symTable = ep-&gt;getParentWithTrait&lt;OpTrait::SymbolTable&gt;();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  HWModuleExternOp endpoint =</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <a class="code" href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a>.declareCosimEndpointFromHostModule(symTable);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="comment">// Create replacement Cosim_Endpoint instance.</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  Value operands[] = {adaptor.getClk(), adaptor.getRst(), recvReady};</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keyword">auto</span> cosimEpModule = rewriter.create&lt;hw::InstanceOp&gt;(</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      loc, endpoint, ep.getIdAttr(), operands, <a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ArrayAttr::get</a>(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>, params));</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">// Set up the injest path.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  Value recvDataFromCosim = cosimEpModule.getResult(1);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  Value recvValidFromCosim = cosimEpModule.getResult(0);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  Value castedRecvData;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a> &gt; 0)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    castedRecvData =</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        rewriter.create&lt;<a class="code" href="classhw_1_1BitcastOp.html">hw::BitcastOp</a>&gt;(loc, type.getInner(), recvDataFromCosim);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    castedRecvData = rewriter.<a class="code" href="classhw_1_1BitcastOp.html#afba533108c6671d4d522a19416084d13">create</a>&lt;<a class="code" href="classhw_1_1ConstantOp.html">hw::ConstantOp</a>&gt;(</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        loc, rewriter.getIntegerType(0),</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        rewriter.getIntegerAttr(rewriter.getIntegerType(0), 0));</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  WrapValidReadyOp wrapRecv = rewriter.create&lt;WrapValidReadyOp&gt;(</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      loc, castedRecvData, recvValidFromCosim);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  recvReady.setValue(wrapRecv.getReady());</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="comment">// Replace the CosimEndpointOp op.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  rewriter.replaceOp(ep, wrapRecv.getChanOutput());</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;}</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">/// Lower `CompressedManifestOps` ops to a module containing an on-chip ROM.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">/// Said module has registered input and outputs, so it has two cycles latency</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">/// between changing the address and the data being reflected on the output.</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"></span><span class="keyword">struct </span>ManifestRomLowering : <span class="keyword">public</span> <a class="code" href="classmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;CompressedManifestOp&gt; {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keyword">using</span> OpConversionPattern::OpConversionPattern;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  constexpr <span class="keyword">static</span> StringRef manifestRomName = <span class="stringliteral">&quot;__ESI_Manifest_ROM&quot;</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  matchAndRewrite(CompressedManifestOp, OpAdaptor adaptor,</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  LogicalResult createRomModule(CompressedManifestOp op,</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;};</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;LogicalResult ManifestRomLowering::createRomModule(</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    CompressedManifestOp op, ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  Location loc = op.getLoc();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keyword">auto</span> mlirModBody = op-&gt;getParentOfType&lt;mlir::ModuleOp&gt;();</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  rewriter.setInsertionPointToStart(mlirModBody.getBody());</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="comment">// Find possible existing module (which may have been created as a dummy</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// module) and erase it.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">if</span> (Operation *existingExtern = mlirModBody.lookupSymbol(manifestRomName)) {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;hw::HWModuleExternOp&gt;(existingExtern))</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">return</span> rewriter.notifyMatchFailure(</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;          op,</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;          <span class="stringliteral">&quot;Found &quot;</span> + manifestRomName + <span class="stringliteral">&quot; but it wasn&#39;t an HWModuleExternOp&quot;</span>);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    rewriter.eraseOp(existingExtern);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="comment">// Create the real module.</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <a class="code" href="structcirct_1_1hw_1_1PortInfo.html">PortInfo</a> ports[] = {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      {{rewriter.getStringAttr(<span class="stringliteral">&quot;clk&quot;</span>), rewriter.getType&lt;seq::ClockType&gt;(),</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <a class="code" href="HW_8h.html#a4d9243df36d6428fdcfe8a23c0db156fabd62348391d75c7fc8c130ea346cba29">ModulePort::Direction::Input</a>}},</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      {{rewriter.getStringAttr(<span class="stringliteral">&quot;address&quot;</span>), rewriter.getIntegerType(30),</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="HW_8h.html#a4d9243df36d6428fdcfe8a23c0db156fabd62348391d75c7fc8c130ea346cba29">ModulePort::Direction::Input</a>}},</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      {{rewriter.getStringAttr(<span class="stringliteral">&quot;data&quot;</span>), rewriter.getI32Type(),</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="HW_8h.html#a4d9243df36d6428fdcfe8a23c0db156fae18e94624772459b0083ef7cc362fc96">ModulePort::Direction::Output</a>}},</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  };</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keyword">auto</span> rom = rewriter.create&lt;HWModuleOp&gt;(</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      loc, rewriter.getStringAttr(manifestRomName), ports);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <a class="code" href="namespacecirct_1_1pretty.html#a18ad32cded9c0ddf25828ba60b130a7dae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> *romBody = rom.getBodyBlock();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  rewriter.setInsertionPointToStart(romBody);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  Value <a class="code" href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba0a3bc2148686f2b562665c3891507e35">clk</a> = romBody-&gt;getArgument(0);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  Value inputAddress = romBody-&gt;getArgument(1);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="comment">// Manifest the compressed manifest into 32-bit words.</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  ArrayRef&lt;uint8_t&gt; maniBytes = op.getCompressedManifest().getData();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  SmallVector&lt;uint32_t&gt; words;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  words.push_back(maniBytes.size());</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; maniBytes.size() - 3; i += 4) {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    uint32_t word = maniBytes[i] | (maniBytes[i + 1] &lt;&lt; 8) |</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                    (maniBytes[i + 2] &lt;&lt; 16) | (maniBytes[i + 3] &lt;&lt; 24);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    words.push_back(word);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordtype">size_t</span> overHang = maniBytes.size() % 4;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordflow">if</span> (overHang != 0) {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    uint32_t word = 0;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; overHang; ++i)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      word |= maniBytes[maniBytes.size() - overHang + i] &lt;&lt; (i * 8);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    words.push_back(word);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// From the words, create an the register which will hold the manifest (and</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// hopefully synthized to a ROM).</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  SmallVector&lt;Attribute&gt; wordAttrs;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">for</span> (uint32_t word : words)</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    wordAttrs.push_back(rewriter.getI32IntegerAttr(word));</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keyword">auto</span> manifestConstant = rewriter.create&lt;hw::AggregateConstantOp&gt;(</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      loc, <a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">hw::UnpackedArrayType::get</a>(rewriter.getI32Type(), words.size()),</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      rewriter.getArrayAttr(wordAttrs));</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keyword">auto</span> manifestReg =</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      rewriter.create&lt;<a class="code" href="classsv_1_1RegOp.html">sv::RegOp</a>&gt;(loc, manifestConstant.getType());</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  rewriter.create&lt;<a class="code" href="classsv_1_1AssignOp.html">sv::AssignOp</a>&gt;(loc, manifestReg, manifestConstant);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="comment">// Slim down the address, register it, do the lookup, and register the output.</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordtype">size_t</span> addrBits = llvm::Log2_64_Ceil(words.size());</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keyword">auto</span> slimmedIdx =</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      rewriter.create&lt;<a class="code" href="classcomb_1_1ExtractOp.html">comb::ExtractOp</a>&gt;(loc, inputAddress, 0, addrBits);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  Value inputAddresReg = rewriter.<a class="code" href="classcomb_1_1ExtractOp.html#ab98d57c1203395ac77b1c3a411d93692">create</a>&lt;<a class="code" href="classseq_1_1CompRegOp.html">seq::CompRegOp</a>&gt;(loc, slimmedIdx, <a class="code" href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba0a3bc2148686f2b562665c3891507e35">clk</a>);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keyword">auto</span> readIdx =</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      rewriter.<a class="code" href="classseq_1_1CompRegOp.html#a2932361bf0228c0841bac1f78d1cee71">create</a>&lt;sv::ArrayIndexInOutOp&gt;(loc, manifestReg, inputAddresReg);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keyword">auto</span> readData = rewriter.create&lt;<a class="code" href="classsv_1_1ReadInOutOp.html">sv::ReadInOutOp</a>&gt;(loc, readIdx);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  Value readDataReg = rewriter.<a class="code" href="classsv_1_1ReadInOutOp.html#af8073db94b825faa47cb49b02b293597">create</a>&lt;<a class="code" href="classseq_1_1CompRegOp.html">seq::CompRegOp</a>&gt;(loc, readData, <a class="code" href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba0a3bc2148686f2b562665c3891507e35">clk</a>);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *term = romBody-&gt;getTerminator())</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    rewriter.eraseOp(term);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  rewriter.<a class="code" href="classseq_1_1CompRegOp.html#a2932361bf0228c0841bac1f78d1cee71">create</a>&lt;hw::OutputOp&gt;(loc, ValueRange{readDataReg});</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;}</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;LogicalResult ManifestRomLowering::matchAndRewrite(</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    CompressedManifestOp op, OpAdaptor adaptor,</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  LogicalResult ret = createRomModule(op, rewriter);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  rewriter.eraseOp(op);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;}</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">/// Lower `CompressedManifestOps` ops to a SystemVerilog module which sets the</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">/// Cosim manifest using a DPI support module.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"></span><span class="keyword">struct </span>CosimManifestLowering : <span class="keyword">public</span> ManifestRomLowering {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keyword">using</span> ManifestRomLowering::ManifestRomLowering;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  LogicalResult</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  matchAndRewrite(CompressedManifestOp, OpAdaptor adaptor,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                  ConversionPatternRewriter &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;};</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160; </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;LogicalResult CosimManifestLowering::matchAndRewrite(</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    CompressedManifestOp op, OpAdaptor adaptor,</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    ConversionPatternRewriter &amp;rewriter)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  MLIRContext *<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a> = rewriter.getContext();</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  Location loc = op.getLoc();</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="comment">// Cosim can optionally include a manifest simulation, so produce it in case</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="comment">// the Cosim BSP wants it.</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  LogicalResult ret = createRomModule(op, rewriter);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordflow">if</span> (failed(ret))</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="comment">// Declare external module.</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  Attribute params[] = {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ParamDeclAttr::get</a>(<span class="stringliteral">&quot;COMPRESSED_MANIFEST_SIZE&quot;</span>, rewriter.getI32Type())};</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <a class="code" href="structcirct_1_1hw_1_1PortInfo.html">PortInfo</a> ports[] = {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      {{rewriter.getStringAttr(<span class="stringliteral">&quot;compressed_manifest&quot;</span>),</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        rewriter.getType&lt;hw::ArrayType&gt;(</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            rewriter.getI8Type(),</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ParamDeclRefAttr::get</a>(</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                rewriter.getStringAttr(<span class="stringliteral">&quot;COMPRESSED_MANIFEST_SIZE&quot;</span>),</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                rewriter.getI32Type())),</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <a class="code" href="HW_8h.html#a4d9243df36d6428fdcfe8a23c0db156fabd62348391d75c7fc8c130ea346cba29">ModulePort::Direction::Input</a>},</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;       0},</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  };</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  rewriter.setInsertionPointToEnd(</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      op-&gt;getParentOfType&lt;mlir::ModuleOp&gt;().getBody());</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keyword">auto</span> cosimManifestExternModule = rewriter.create&lt;HWModuleExternOp&gt;(</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      loc, rewriter.getStringAttr(<span class="stringliteral">&quot;Cosim_Manifest&quot;</span>), ports, <span class="stringliteral">&quot;Cosim_Manifest&quot;</span>,</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">ArrayAttr::get</a>(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>, params));</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  hw::ModulePortInfo portInfo({});</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keyword">auto</span> manifestMod = rewriter.create&lt;<a class="code" href="classhw_1_1HWModuleOp.html">hw::HWModuleOp</a>&gt;(</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      loc, rewriter.getStringAttr(<span class="stringliteral">&quot;__ESIManifest&quot;</span>), portInfo,</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      [&amp;](OpBuilder &amp;rewriter, <span class="keyword">const</span> hw::HWModulePortAccessor &amp;) {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">// Assemble the manifest data into a constant.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        SmallVector&lt;Attribute&gt; bytes;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">for</span> (uint8_t b : op.getCompressedManifest().getData())</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          bytes.push_back(rewriter.getI8IntegerAttr(b));</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keyword">auto</span> manifestConstant = rewriter.create&lt;hw::AggregateConstantOp&gt;(</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            loc, <a class="code" href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">hw::ArrayType::get</a>(rewriter.getI8Type(), bytes.size()),</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            rewriter.getArrayAttr(bytes));</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keyword">auto</span> manifestLogic =</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            rewriter.create&lt;sv::LogicOp&gt;(loc, manifestConstant.getType());</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        rewriter.create&lt;<a class="code" href="classsv_1_1AssignOp.html">sv::AssignOp</a>&gt;(loc, manifestLogic, manifestConstant);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="keyword">auto</span> manifest = rewriter.<a class="code" href="classsv_1_1AssignOp.html#abc5a81134c48aecc39b50872a0b84084">create</a>&lt;<a class="code" href="classsv_1_1ReadInOutOp.html">sv::ReadInOutOp</a>&gt;(loc, manifestLogic);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="comment">// Then instantiate the external module.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        rewriter.<a class="code" href="classsv_1_1ReadInOutOp.html#af8073db94b825faa47cb49b02b293597">create</a>&lt;hw::InstanceOp&gt;(</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            loc, cosimManifestExternModule, <span class="stringliteral">&quot;__manifest&quot;</span>,</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            ArrayRef&lt;Value&gt;({manifest}),</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            rewriter.getArrayAttr({ParamDeclAttr::get(</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="stringliteral">&quot;COMPRESSED_MANIFEST_SIZE&quot;</span>,</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                rewriter.getI32IntegerAttr(bytes.size()))}));</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      });</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  rewriter.setInsertionPoint(op);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  rewriter.create&lt;hw::InstanceOp&gt;(loc, manifestMod, <span class="stringliteral">&quot;__manifest&quot;</span>,</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                  ArrayRef&lt;Value&gt;({}));</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  rewriter.eraseOp(op);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keywordflow">return</span> success();</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="keywordtype">void</span> ESItoHWPass::runOnOperation() {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keyword">auto</span> top = getOperation();</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a> = &amp;getContext();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  ConversionTarget noBundlesTarget(*<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  noBundlesTarget.markUnknownOpDynamicallyLegal(</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      [](Operation *) { <span class="keywordflow">return</span> <span class="keyword">true</span>; });</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  noBundlesTarget.addIllegalOp&lt;PackBundleOp&gt;();</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  noBundlesTarget.addIllegalOp&lt;UnpackBundleOp&gt;();</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  RewritePatternSet bundlePatterns(&amp;getContext());</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  bundlePatterns.add&lt;CanonicalizerOpLowering&lt;PackBundleOp&gt;&gt;(&amp;getContext());</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  bundlePatterns.add&lt;CanonicalizerOpLowering&lt;UnpackBundleOp&gt;&gt;(&amp;getContext());</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordflow">if</span> (failed(applyPartialConversion(getOperation(), noBundlesTarget,</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                    std::move(bundlePatterns))))</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    signalPassFailure();</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">// Set up a conversion and give it a set of laws.</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  ConversionTarget pass1Target(*<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  pass1Target.addLegalDialect&lt;comb::CombDialect&gt;();</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  pass1Target.addLegalDialect&lt;HWDialect&gt;();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  pass1Target.addLegalDialect&lt;SVDialect&gt;();</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  pass1Target.addLegalDialect&lt;seq::SeqDialect&gt;();</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  pass1Target.addLegalOp&lt;WrapValidReadyOp, UnwrapValidReadyOp&gt;();</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  pass1Target.addIllegalOp&lt;WrapSVInterfaceOp, UnwrapSVInterfaceOp&gt;();</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  pass1Target.addIllegalOp&lt;PipelineStageOp&gt;();</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  pass1Target.addIllegalOp&lt;CompressedManifestOp&gt;();</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="comment">// Add all the conversion patterns.</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <a class="code" href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html">ESIHWBuilder</a> esiBuilder(top);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  RewritePatternSet pass1Patterns(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  pass1Patterns.insert&lt;PipelineStageLowering&gt;(esiBuilder, <a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  pass1Patterns.insert&lt;WrapInterfaceLower&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  pass1Patterns.insert&lt;UnwrapInterfaceLower&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  pass1Patterns.insert&lt;CosimToHostLowering&gt;(esiBuilder);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  pass1Patterns.insert&lt;CosimFromHostLowering&gt;(esiBuilder);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  pass1Patterns.insert&lt;NullSourceOpLowering&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keywordflow">if</span> (platform == <a class="code" href="structcirct_1_1esi_1_1Platform.html#aefff7ef6b263994ec16ea10f45b2fa6d">Platform::cosim</a>)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    pass1Patterns.insert&lt;CosimManifestLowering&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (platform == <a class="code" href="structcirct_1_1esi_1_1Platform.html#abda0344a7dbc2aaa4a70dd64a1033b40">Platform::fpga</a>)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    pass1Patterns.insert&lt;ManifestRomLowering&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    pass1Patterns.insert&lt;<a class="code" href="structcirct_1_1esi_1_1detail_1_1RemoveOpLowering.html">RemoveOpLowering&lt;CompressedManifestOp&gt;</a>&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">// Run the conversion.</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keywordflow">if</span> (failed(</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;          applyPartialConversion(top, pass1Target, std::move(pass1Patterns))))</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    signalPassFailure();</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  ConversionTarget pass2Target(*<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  pass2Target.addLegalDialect&lt;comb::CombDialect&gt;();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  pass2Target.addLegalDialect&lt;HWDialect&gt;();</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  pass2Target.addLegalDialect&lt;SVDialect&gt;();</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  pass2Target.addIllegalDialect&lt;ESIDialect&gt;();</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  RewritePatternSet pass2Patterns(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  pass2Patterns.insert&lt;CanonicalizerOpLowering&lt;UnwrapFIFOOp&gt;&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  pass2Patterns.insert&lt;CanonicalizerOpLowering&lt;WrapFIFOOp&gt;&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  pass2Patterns.insert&lt;RemoveWrapUnwrap&gt;(<a class="code" href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">ctxt</a>);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="keywordflow">if</span> (failed(</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          applyPartialConversion(top, pass2Target, std::move(pass2Patterns))))</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    signalPassFailure();</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;}</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno"><a class="line" href="namespacecirct_1_1esi.html#a0250b04de3a586d1534cbdab4c9150c8">  699</a></span>&#160;std::unique_ptr&lt;OperationPass&lt;ModuleOp&gt;&gt; <a class="code" href="namespacecirct_1_1esi.html#a0250b04de3a586d1534cbdab4c9150c8">circt::esi::createESItoHWPass</a>() {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keywordflow">return</span> std::make_unique&lt;ESItoHWPass&gt;();</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;}</div>
<div class="ttc" id="aAPIUtilities_8h_html"><div class="ttname"><a href="APIUtilities_8h.html">APIUtilities.h</a></div></div>
<div class="ttc" id="aBackedgeBuilder_8h_html"><div class="ttname"><a href="BackedgeBuilder_8h.html">BackedgeBuilder.h</a></div></div>
<div class="ttc" id="aCHIRRTL_8cpp_html_a4eaef01137c01077dd22d124614caea9"><div class="ttname"><a href="CHIRRTL_8cpp.html#a4eaef01137c01077dd22d124614caea9">wrap</a></div><div class="ttdeci">return wrap(CMemoryType::get(unwrap(ctx), baseType, numElements))</div></div>
<div class="ttc" id="aCombOps_8h_html"><div class="ttname"><a href="CombOps_8h.html">CombOps.h</a></div></div>
<div class="ttc" id="aESIOps_8h_html"><div class="ttname"><a href="ESIOps_8h.html">ESIOps.h</a></div></div>
<div class="ttc" id="aFIRRTL_8cpp_html_a395d15e7c2b09961c1bfd1da6179b64c"><div class="ttname"><a href="FIRRTL_8cpp.html#a395d15e7c2b09961c1bfd1da6179b64c">width</a></div><div class="ttdeci">int32_t width</div><div class="ttdef"><b>Definition:</b> <a href="FIRRTL_8cpp_source.html#l00036">FIRRTL.cpp:36</a></div></div>
<div class="ttc" id="aHWOps_8h_html"><div class="ttname"><a href="HWOps_8h.html">HWOps.h</a></div></div>
<div class="ttc" id="aHW_8h_html_a4d9243df36d6428fdcfe8a23c0db156fabd62348391d75c7fc8c130ea346cba29"><div class="ttname"><a href="HW_8h.html#a4d9243df36d6428fdcfe8a23c0db156fabd62348391d75c7fc8c130ea346cba29">Input</a></div><div class="ttdeci">@ Input</div><div class="ttdef"><b>Definition:</b> <a href="HW_8h_source.html#l00035">HW.h:35</a></div></div>
<div class="ttc" id="aHW_8h_html_a4d9243df36d6428fdcfe8a23c0db156fae18e94624772459b0083ef7cc362fc96"><div class="ttname"><a href="HW_8h.html#a4d9243df36d6428fdcfe8a23c0db156fae18e94624772459b0083ef7cc362fc96">Output</a></div><div class="ttdeci">@ Output</div><div class="ttdef"><b>Definition:</b> <a href="HW_8h_source.html#l00035">HW.h:35</a></div></div>
<div class="ttc" id="aLLVM_8h_html"><div class="ttname"><a href="LLVM_8h.html">LLVM.h</a></div></div>
<div class="ttc" id="aOM_8cpp_html_ad61dc262c3ee84078d8526986a6a5727"><div class="ttname"><a href="OM_8cpp.html#ad61dc262c3ee84078d8526986a6a5727">unwrap</a></div><div class="ttdeci">static EvaluatorValuePtr unwrap(OMEvaluatorValue c)</div><div class="ttdef"><b>Definition:</b> <a href="OM_8cpp_source.html#l00096">OM.cpp:96</a></div></div>
<div class="ttc" id="aPassHelpers_8cpp_html_aeadefc9e3d2de1953d16800a15493a47"><div class="ttname"><a href="PassHelpers_8cpp.html#aeadefc9e3d2de1953d16800a15493a47">builder</a></div><div class="ttdeci">Builder builder</div><div class="ttdef"><b>Definition:</b> <a href="PassHelpers_8cpp_source.html#l00252">PassHelpers.cpp:252</a></div></div>
<div class="ttc" id="aSVOps_8h_html"><div class="ttname"><a href="SVOps_8h.html">SVOps.h</a></div></div>
<div class="ttc" id="aSeqOps_8h_html"><div class="ttname"><a href="SeqOps_8h.html">SeqOps.h</a></div></div>
<div class="ttc" id="aSymCache_8h_html"><div class="ttname"><a href="SymCache_8h.html">SymCache.h</a></div></div>
<div class="ttc" id="aclasscirct_1_1BackedgeBuilder_html"><div class="ttname"><a href="classcirct_1_1BackedgeBuilder.html">circt::BackedgeBuilder</a></div><div class="ttdoc">Instantiate one of these and use it to build typed backedges.</div><div class="ttdef"><b>Definition:</b> <a href="BackedgeBuilder_8h_source.html#l00046">BackedgeBuilder.h:46</a></div></div>
<div class="ttc" id="aclasscirct_1_1Backedge_html"><div class="ttname"><a href="classcirct_1_1Backedge.html">circt::Backedge</a></div><div class="ttdoc">Backedge is a wrapper class around a Value.</div><div class="ttdef"><b>Definition:</b> <a href="BackedgeBuilder_8h_source.html#l00080">BackedgeBuilder.h:80</a></div></div>
<div class="ttc" id="aclasscirct_1_1Backedge_html_af1917cf5c65da45ab8e874b6d7464a26"><div class="ttname"><a href="classcirct_1_1Backedge.html#af1917cf5c65da45ab8e874b6d7464a26">circt::Backedge::setValue</a></div><div class="ttdeci">void setValue(mlir::Value)</div><div class="ttdef"><b>Definition:</b> <a href="BackedgeBuilder_8cpp_source.html#l00023">BackedgeBuilder.cpp:23</a></div></div>
<div class="ttc" id="aclasscirct_1_1esi_1_1detail_1_1ESIHWBuilder_html"><div class="ttname"><a href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html">circt::esi::detail::ESIHWBuilder</a></div><div class="ttdoc">Assist the lowering steps for conversions which need to create auxiliary IR.</div><div class="ttdef"><b>Definition:</b> <a href="ESI_2PassDetails_8h_source.html#l00065">PassDetails.h:65</a></div></div>
<div class="ttc" id="aclasscirct_1_1esi_1_1detail_1_1ESIHWBuilder_html_a352855bb285ae6506969acc79563047c"><div class="ttname"><a href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a352855bb285ae6506969acc79563047c">circt::esi::detail::ESIHWBuilder::validStr</a></div><div class="ttdeci">static constexpr char validStr[]</div><div class="ttdef"><b>Definition:</b> <a href="ESI_2PassDetails_8h_source.html#l00085">PassDetails.h:85</a></div></div>
<div class="ttc" id="aclasscirct_1_1esi_1_1detail_1_1ESIHWBuilder_html_a583938599a6e69c52460fc75508820f1"><div class="ttname"><a href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a583938599a6e69c52460fc75508820f1">circt::esi::detail::ESIHWBuilder::readyStr</a></div><div class="ttdeci">static constexpr char readyStr[]</div><div class="ttdef"><b>Definition:</b> <a href="ESI_2PassDetails_8h_source.html#l00086">PassDetails.h:86</a></div></div>
<div class="ttc" id="aclasscirct_1_1esi_1_1detail_1_1ESIHWBuilder_html_a5e2cc8a456f02960e94d08cae22e92b3"><div class="ttname"><a href="classcirct_1_1esi_1_1detail_1_1ESIHWBuilder.html#a5e2cc8a456f02960e94d08cae22e92b3">circt::esi::detail::ESIHWBuilder::dataStr</a></div><div class="ttdeci">static constexpr char dataStr[]</div><div class="ttdef"><b>Definition:</b> <a href="ESI_2PassDetails_8h_source.html#l00085">PassDetails.h:85</a></div></div>
<div class="ttc" id="aclasscomb_1_1ExtractOp_html"><div class="ttname"><a href="classcomb_1_1ExtractOp.html">comb.ExtractOp</a></div><div class="ttdef"><b>Definition:</b> <a href="comb_8py_source.html#l00184">comb.py:184</a></div></div>
<div class="ttc" id="aclasscomb_1_1ExtractOp_html_ab98d57c1203395ac77b1c3a411d93692"><div class="ttname"><a href="classcomb_1_1ExtractOp.html#ab98d57c1203395ac77b1c3a411d93692">comb.ExtractOp.create</a></div><div class="ttdeci">def create(low_bit, result_type, input=None)</div><div class="ttdef"><b>Definition:</b> <a href="comb_8py_source.html#l00187">comb.py:187</a></div></div>
<div class="ttc" id="aclasshw_1_1BitcastOp_html"><div class="ttname"><a href="classhw_1_1BitcastOp.html">hw.BitcastOp</a></div><div class="ttdef"><b>Definition:</b> <a href="hw_8py_source.html#l00398">hw.py:398</a></div></div>
<div class="ttc" id="aclasshw_1_1BitcastOp_html_afba533108c6671d4d522a19416084d13"><div class="ttname"><a href="classhw_1_1BitcastOp.html#afba533108c6671d4d522a19416084d13">hw.BitcastOp.create</a></div><div class="ttdeci">def create(data_type, value)</div><div class="ttdef"><b>Definition:</b> <a href="hw_8py_source.html#l00401">hw.py:401</a></div></div>
<div class="ttc" id="aclasshw_1_1ConstantOp_html"><div class="ttname"><a href="classhw_1_1ConstantOp.html">hw.ConstantOp</a></div><div class="ttdef"><b>Definition:</b> <a href="hw_8py_source.html#l00390">hw.py:390</a></div></div>
<div class="ttc" id="aclasshw_1_1ConstantOp_html_a8904bc93000d6ef24ace4587a4d0bd7a"><div class="ttname"><a href="classhw_1_1ConstantOp.html#a8904bc93000d6ef24ace4587a4d0bd7a">hw.ConstantOp.create</a></div><div class="ttdeci">def create(data_type, value)</div><div class="ttdef"><b>Definition:</b> <a href="hw_8py_source.html#l00393">hw.py:393</a></div></div>
<div class="ttc" id="aclasshw_1_1HWModuleOp_html"><div class="ttname"><a href="classhw_1_1HWModuleOp.html">hw.HWModuleOp</a></div><div class="ttdef"><b>Definition:</b> <a href="hw_8py_source.html#l00294">hw.py:294</a></div></div>
<div class="ttc" id="aclassmlir_1_1OpConversionPattern_html"><div class="ttname"><a href="classmlir_1_1OpConversionPattern.html">mlir::OpConversionPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVM_8h_source.html#l00179">LLVM.h:179</a></div></div>
<div class="ttc" id="aclassseq_1_1CompRegOp_html"><div class="ttname"><a href="classseq_1_1CompRegOp.html">seq.CompRegOp</a></div><div class="ttdef"><b>Definition:</b> <a href="seq_8py_source.html#l00128">seq.py:128</a></div></div>
<div class="ttc" id="aclassseq_1_1CompRegOp_html_a2932361bf0228c0841bac1f78d1cee71"><div class="ttname"><a href="classseq_1_1CompRegOp.html#a2932361bf0228c0841bac1f78d1cee71">seq.CompRegOp.create</a></div><div class="ttdeci">def create(cls, result_type, reset=None, reset_value=None, name=None, sym_name=None, **kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="seq_8py_source.html#l00131">seq.py:137</a></div></div>
<div class="ttc" id="aclasssv_1_1AssignOp_html"><div class="ttname"><a href="classsv_1_1AssignOp.html">sv.AssignOp</a></div><div class="ttdef"><b>Definition:</b> <a href="sv_8py_source.html#l00095">sv.py:95</a></div></div>
<div class="ttc" id="aclasssv_1_1AssignOp_html_abc5a81134c48aecc39b50872a0b84084"><div class="ttname"><a href="classsv_1_1AssignOp.html#abc5a81134c48aecc39b50872a0b84084">sv.AssignOp.create</a></div><div class="ttdeci">def create(dest, src)</div><div class="ttdef"><b>Definition:</b> <a href="sv_8py_source.html#l00098">sv.py:98</a></div></div>
<div class="ttc" id="aclasssv_1_1ReadInOutOp_html"><div class="ttname"><a href="classsv_1_1ReadInOutOp.html">sv.ReadInOutOp</a></div><div class="ttdef"><b>Definition:</b> <a href="sv_8py_source.html#l00103">sv.py:103</a></div></div>
<div class="ttc" id="aclasssv_1_1ReadInOutOp_html_af8073db94b825faa47cb49b02b293597"><div class="ttname"><a href="classsv_1_1ReadInOutOp.html#af8073db94b825faa47cb49b02b293597">sv.ReadInOutOp.create</a></div><div class="ttdeci">def create(value)</div><div class="ttdef"><b>Definition:</b> <a href="sv_8py_source.html#l00106">sv.py:106</a></div></div>
<div class="ttc" id="aclasssv_1_1RegOp_html"><div class="ttname"><a href="classsv_1_1RegOp.html">sv.RegOp</a></div><div class="ttdef"><b>Definition:</b> <a href="sv_8py_source.html#l00068">sv.py:68</a></div></div>
<div class="ttc" id="anamespacecirct_1_1calyx_1_1direction_html_aa581977b67c4a52e186e2d320010f50f"><div class="ttname"><a href="namespacecirct_1_1calyx_1_1direction.html#aa581977b67c4a52e186e2d320010f50f">circt::calyx::direction::get</a></div><div class="ttdeci">Direction get(bool isOutput)</div><div class="ttdoc">Returns an output direction if isOutput is true, otherwise returns an input direction.</div><div class="ttdef"><b>Definition:</b> <a href="CalyxOps_8cpp_source.html#l00054">CalyxOps.cpp:54</a></div></div>
<div class="ttc" id="anamespacecirct_1_1esi_1_1detail_html"><div class="ttname"><a href="namespacecirct_1_1esi_1_1detail.html">circt::esi::detail</a></div><div class="ttdef"><b>Definition:</b> <a href="ESI_2PassDetails_8h_source.html#l00045">PassDetails.h:45</a></div></div>
<div class="ttc" id="anamespacecirct_1_1esi_1_1detail_html_a8294216b8309ec352bf4c5da5a5fd47e"><div class="ttname"><a href="namespacecirct_1_1esi_1_1detail.html#a8294216b8309ec352bf4c5da5a5fd47e">circt::esi::detail::getWidth</a></div><div class="ttdeci">uint64_t getWidth(Type t)</div><div class="ttdef"><b>Definition:</b> <a href="ESIPasses_8cpp_source.html#l00034">ESIPasses.cpp:34</a></div></div>
<div class="ttc" id="anamespacecirct_1_1esi_1_1detail_html_a9b554f78a3b4315d89c337dabd6a1851"><div class="ttname"><a href="namespacecirct_1_1esi_1_1detail.html#a9b554f78a3b4315d89c337dabd6a1851">circt::esi::detail::getTypeID</a></div><div class="ttdeci">StringAttr getTypeID(Type t)</div><div class="ttdef"><b>Definition:</b> <a href="ESIPasses_8cpp_source.html#l00026">ESIPasses.cpp:26</a></div></div>
<div class="ttc" id="anamespacecirct_1_1esi_html"><div class="ttname"><a href="namespacecirct_1_1esi.html">circt::esi</a></div><div class="ttdef"><b>Definition:</b> <a href="HandshakeToHW_8h_source.html#l00027">HandshakeToHW.h:27</a></div></div>
<div class="ttc" id="anamespacecirct_1_1esi_html_a0250b04de3a586d1534cbdab4c9150c8"><div class="ttname"><a href="namespacecirct_1_1esi.html#a0250b04de3a586d1534cbdab4c9150c8">circt::esi::createESItoHWPass</a></div><div class="ttdeci">std::unique_ptr&lt; OperationPass&lt; ModuleOp &gt; &gt; createESItoHWPass()</div><div class="ttdef"><b>Definition:</b> <a href="ESILowerToHW_8cpp_source.html#l00699">ESILowerToHW.cpp:699</a></div></div>
<div class="ttc" id="anamespacecirct_1_1esi_html_a989620eb18fae9f9d4ed78419b7a9efd"><div class="ttname"><a href="namespacecirct_1_1esi.html#a989620eb18fae9f9d4ed78419b7a9efd">circt::esi::innerType</a></div><div class="ttdeci">mlir::Type innerType(mlir::Type type)</div><div class="ttdef"><b>Definition:</b> <a href="ESITypes_8cpp_source.html#l00184">ESITypes.cpp:184</a></div></div>
<div class="ttc" id="anamespacecirct_1_1firrtl_html_aebf8b3cc28bb223c902990355e42a74ba0a3bc2148686f2b562665c3891507e35"><div class="ttname"><a href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba0a3bc2148686f2b562665c3891507e35">circt::firrtl::ReadPortSubfield::clk</a></div><div class="ttdeci">@ clk</div></div>
<div class="ttc" id="anamespacecirct_1_1firrtl_html_aebf8b3cc28bb223c902990355e42a74ba8d777f385d3dfec8815d20f7496026dc"><div class="ttname"><a href="namespacecirct_1_1firrtl.html#aebf8b3cc28bb223c902990355e42a74ba8d777f385d3dfec8815d20f7496026dc">circt::firrtl::ReadPortSubfield::data</a></div><div class="ttdeci">@ data</div></div>
<div class="ttc" id="anamespacecirct_1_1hw_html"><div class="ttname"><a href="namespacecirct_1_1hw.html">circt::hw</a></div><div class="ttdef"><b>Definition:</b> <a href="HWToSV_8h_source.html#l00025">HWToSV.h:25</a></div></div>
<div class="ttc" id="anamespacecirct_1_1hw_html_ac9803400d01843629490fcba24fed85d"><div class="ttname"><a href="namespacecirct_1_1hw.html#ac9803400d01843629490fcba24fed85d">circt::hw::getBitWidth</a></div><div class="ttdeci">int64_t getBitWidth(mlir::Type type)</div><div class="ttdoc">Return the hardware bit width of a type.</div><div class="ttdef"><b>Definition:</b> <a href="HWTypes_8cpp_source.html#l00102">HWTypes.cpp:102</a></div></div>
<div class="ttc" id="anamespacecirct_1_1pretty_html_a18ad32cded9c0ddf25828ba60b130a7dae1e4c8c9ccd9fc39c391da4bcd093fb2"><div class="ttname"><a href="namespacecirct_1_1pretty.html#a18ad32cded9c0ddf25828ba60b130a7dae1e4c8c9ccd9fc39c391da4bcd093fb2">circt::pretty::IndentStyle::Block</a></div><div class="ttdeci">@ Block</div></div>
<div class="ttc" id="anamespacecirct_1_1sv_html"><div class="ttname"><a href="namespacecirct_1_1sv.html">circt::sv</a></div><div class="ttdef"><b>Definition:</b> <a href="SVAttributes_8h_source.html#l00023">SVAttributes.h:23</a></div></div>
<div class="ttc" id="anamespacecirct_html"><div class="ttname"><a href="namespacecirct.html">circt</a></div><div class="ttdoc">This file defines an intermediate representation for circuits acting as an abstraction for constraint...</div><div class="ttdef"><b>Definition:</b> <a href="DebugAnalysis_8h_source.html#l00021">DebugAnalysis.h:21</a></div></div>
<div class="ttc" id="anamespaceesiaccel_1_1accelerator_html_a7509062cd2df99270e72fda2b4009158"><div class="ttname"><a href="namespaceesiaccel_1_1accelerator.html#a7509062cd2df99270e72fda2b4009158">esiaccel.accelerator.ctxt</a></div><div class="ttdeci">ctxt</div><div class="ttdef"><b>Definition:</b> <a href="accelerator_8py_source.html#l00019">accelerator.py:19</a></div></div>
<div class="ttc" id="astructcirct_1_1esi_1_1Platform_html_abda0344a7dbc2aaa4a70dd64a1033b40"><div class="ttname"><a href="structcirct_1_1esi_1_1Platform.html#abda0344a7dbc2aaa4a70dd64a1033b40">circt::esi::Platform::fpga</a></div><div class="ttdeci">static constexpr char fpga[]</div><div class="ttdef"><b>Definition:</b> <a href="ESIPasses_8h_source.html#l00029">ESIPasses.h:29</a></div></div>
<div class="ttc" id="astructcirct_1_1esi_1_1Platform_html_aefff7ef6b263994ec16ea10f45b2fa6d"><div class="ttname"><a href="structcirct_1_1esi_1_1Platform.html#aefff7ef6b263994ec16ea10f45b2fa6d">circt::esi::Platform::cosim</a></div><div class="ttdeci">static constexpr char cosim[]</div><div class="ttdef"><b>Definition:</b> <a href="ESIPasses_8h_source.html#l00028">ESIPasses.h:28</a></div></div>
<div class="ttc" id="astructcirct_1_1esi_1_1detail_1_1RemoveOpLowering_html"><div class="ttname"><a href="structcirct_1_1esi_1_1detail_1_1RemoveOpLowering.html">circt::esi::detail::RemoveOpLowering</a></div><div class="ttdoc">Generic pattern for removing an op during pattern conversion.</div><div class="ttdef"><b>Definition:</b> <a href="ESI_2PassDetails_8h_source.html#l00049">PassDetails.h:49</a></div></div>
<div class="ttc" id="astructcirct_1_1hw_1_1PortInfo_html"><div class="ttname"><a href="structcirct_1_1hw_1_1PortInfo.html">circt::hw::PortInfo</a></div><div class="ttdoc">This holds the name, type, direction of a module's ports.</div><div class="ttdef"><b>Definition:</b> <a href="PortImplementation_8h_source.html#l00024">PortImplementation.h:24</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 28 2024 00:06:53 for CIRCT by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
